{"children":[{"children":[],"uri":"https://www.notion.so/47b71c4768724d7898a2c67579b0f2c1","type":"heading","createdTime":1617011580000,"lastEditedTime":1617011580000,"title":[["The Heim"]],"depth":2},{"children":[{"children":[],"uri":"https://www.notion.so/4773207ab6534064afdde01fba146aa7","type":"image","createdTime":1617011640000,"lastEditedTime":1617013200000,"source":"https://i.imgur.com/96m81yH.png?width=864","caption":[],"width":864,"height":-1,"fullWidth":false,"pageWidth":false,"aspectRatio":-1,"preserveScale":true}],"uri":"https://www.notion.so/85e610aeb5e345dba6bf9a4729962277","type":"bulleted_list","createdTime":1617011640000,"lastEditedTime":1617013200000,"title":[["Upon navigating to the given URL, we're met with a login form which asks the user for a \"name\", claiming that \"only those who "],["BEARER",[["_",null]]],[" a token may enter\"."]]},{"children":[{"children":[],"uri":"https://www.notion.so/0dd2bd1e47d64f9cba3dbae539079eb8","type":"image","createdTime":1617012180000,"lastEditedTime":1617012240000,"source":"https://i.imgur.com/s2PtrcI.png?width=624","caption":[],"width":624,"height":-1,"fullWidth":false,"pageWidth":false,"aspectRatio":-1,"preserveScale":true}],"uri":"https://www.notion.so/351b977e2b7a40e2bfebb231c57830d3","type":"bulleted_list","createdTime":1617012060000,"lastEditedTime":1617015420000,"title":[["After entering a name and hitting \"Enter\", we are then redirected to the "],["/auth/authorised",[["c",null]]],[" page containing our access token:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/12335b0d7c2741beaab85ae2251cbfe5","type":"image","createdTime":1617012720000,"lastEditedTime":1617021180000,"source":"https://i.imgur.com/IVE3srk.png?width=720","caption":[],"width":720,"height":-1,"fullWidth":false,"pageWidth":false,"aspectRatio":0.4603107937841243,"preserveScale":true}],"uri":"https://www.notion.so/305d10c0122845cfbea73e9f8b8b1b1c","type":"bulleted_list","createdTime":1617012648670,"lastEditedTime":1617021120000,"title":[["This likely suggests that we're dealing with some type of bearer token authentication. Bearer tokens allow requests to authenticate by using a cryptic string generated and encrypted by the server, such as a JSON Web Token, which looks something akin to this:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/aaba912d02ea4cfcb81a3e3cd290a35b","type":"code","createdTime":1617015540000,"lastEditedTime":1617015960000,"title":[["Authorization: Bearer <JWT>"]],"language":"HTML","wrap":false}],"uri":"https://www.notion.so/58b1a95ed5404e03be90b89969575368","type":"bulleted_list","createdTime":1617015480000,"lastEditedTime":1617015600000,"title":[["This token is then included in the HTTP header, in the format of:"]]},{"children":[],"uri":"https://www.notion.so/34cd77334cd948e4ba83f04486fbe4e4","type":"heading","createdTime":1617019980000,"lastEditedTime":1617019980000,"title":[["Intercepting requests with Burp Suite"]],"depth":2},{"children":[{"children":[],"uri":"https://www.notion.so/a00ba5a8c7ae495eaf941f4b5f594802","type":"image","createdTime":1617015720000,"lastEditedTime":1617019980000,"source":"https://i.imgur.com/EZ3LsiC.png?width=1392","caption":[],"width":1392,"height":-1,"fullWidth":false,"pageWidth":false,"aspectRatio":-1,"preserveScale":true}],"uri":"https://www.notion.so/e1bb9e1714e544c4b360f6b4a9e961cd","type":"bulleted_list","createdTime":1617013500000,"lastEditedTime":1617019980000,"title":[["Let's intercept the outbound POST request made to "],["/auth",[["c",null]]],[" with Burp Suite's proxy feature, and forward the request to the repeater with "],["Ctrl-R",[["c",null]]],[" to try and figure out what is happening behind the scenes:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/800724133cc945a898e23ab06e83552e","type":"text","createdTime":1617022800000,"lastEditedTime":1617022800000,"title":[["/auth?access_token=<JWT>&jwt_secret_key=arottenbranchwillbefoundineverytree",[["c",null]]]]}],"uri":"https://www.notion.so/852e585923fa41d087264c6064f51c3d","type":"bulleted_list","createdTime":1617015420000,"lastEditedTime":1617022800000,"title":[["We see that the browser first makes a POST request to "],["/auth",[["c",null]]],[" with the form data, and is then redirected to the URL:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/59accdb694704d6a91b46617899a2fe8","type":"text","createdTime":1617017220000,"lastEditedTime":1617017340000,"title":[["arottenbranchwillbefoundineverytree",[["c",null]]]]}],"uri":"https://www.notion.so/16796a9975e6415e99306d0970c4d856","type":"bulleted_list","createdTime":1617015900000,"lastEditedTime":1617022440000,"title":[["Leaked at the end of the redirect URL is the "],["jwt_secret_key",[["c",null]]],[", which is used for encrypting JSON Web Tokens:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/ce81700eb2a54f55b55814e171516517","type":"code","createdTime":1617017220000,"lastEditedTime":1617017400000,"title":[["{\n  \"msg\": \"Missing Authorization Header\"\n}"]],"language":"JSON","wrap":false}],"uri":"https://www.notion.so/e0dc3cd61753440f84e28f01bf66c97f","type":"bulleted_list","createdTime":1617017221065,"lastEditedTime":1617017400000,"title":[["While looking for more API endpoints on the website by trying related keywords, we stumbled upon "],["/heim",[["c",null]]],[", which returned:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/f53de0b4747a4274af76714f603bffad","type":"image","createdTime":1617017580000,"lastEditedTime":1617017640000,"source":"https://i.imgur.com/HR6kSKQ.png?width=1392","caption":[],"width":1392,"height":-1,"fullWidth":false,"pageWidth":false,"aspectRatio":-1,"preserveScale":true}],"uri":"https://www.notion.so/44a0b920f57b418f97141eadbbad3f46","type":"bulleted_list","createdTime":1617017340000,"lastEditedTime":1617017580000,"title":[["This means that the web server is expecting a Bearer token in the HTTP header, so let's add that to our request in Burp Suite's repeater:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/f87c2d5fe2dc434c8e42d0bc80068ba9","type":"text","createdTime":1617017640000,"lastEditedTime":1617017940000,"title":[["$ echo \"ewogICAgIm...AgIH0KfQ==\" | base64 -d",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/8f51c0c1910543e49d95ae2ff7833b55","type":"code","createdTime":1617017760000,"lastEditedTime":1617017760000,"title":[["{\n  \"api\": {\n      \"v1\": {\n          \"/auth\": {\n              \"get\": {\n                  \"summary\": \"Debugging method for authorization post\",\n                  \"security\": \"None\",\n                  \"parameters\": {\n                      \"access_token\": {\n                          \"required\": true,\n                          \"description\": \"Access token from recently authorized Viking\",\n                          \"in\": \"path\",\n                      },\n                      \"jwt_secret_key\": {\n                          \"required\": false,\n                          \"description\": \"Debugging - should be removed in prod Heim\",\n                          \"in\": \"path\"\n                      }\n                  }\n              },\n              \"post\": {\n                  \"summary\": \"Authorize yourself as a Viking\",\n                  \"security\": \"None\",\n                  \"parameters\": {\n                      \"username\": {\n                          \"required\": true,\n                          \"description\": \"Your Viking name\",\n                          \"in\": \"body\",\n                          \"content\": \"multipart/x-www-form-urlencoded\"\n                      }\n                  }\n              }\n          },\n          \"/heim\": {\n              \"get\": {\n                  \"summary\": \"List the endpoints available to named Vikings\",\n                  \"security\": \"BearerAuth\"\n              }\n          },\n          \"/flag\": {\n              \"get\": {\n                  \"summary\": \"Retrieve the flag\",\n                  \"security\": \"BearerAuth\"\n              }\n          }\n      }\n  }\n}"]],"language":"JSON","wrap":false}],"uri":"https://www.notion.so/7a56d3e1739949fb998c927b2c160f2e","type":"bulleted_list","createdTime":1617017640000,"lastEditedTime":1617017760000,"title":[["We received a massive message encoded in base64, let's decode it:"]]},{"children":[],"uri":"https://www.notion.so/3ff54d2a4e4e4c2f903246074c0ed10c","type":"bulleted_list","createdTime":1617017820000,"lastEditedTime":1617018060000,"title":[["Nice! We have obtained a list of all available endpoints and now know the flag is located at "],["/flag",[["c",null]]],[", and that the GET method for "],["/auth",[["c",null]]],[" was originally meant to be a debugging endpoint, explaining why "],["jwt_secret_key",[["c",null]]],[" was leaked in the redirect URL."]]},{"children":[{"children":[],"uri":"https://www.notion.so/9223f0f90ae2461b9ce4e229a827fbca","type":"code","createdTime":1617017880000,"lastEditedTime":1617017940000,"title":[["{\n  \"msg\": \"You are not worthy. Only the AllFather Odin may view the flag\"\n}"]],"language":"JSON","wrap":false}],"uri":"https://www.notion.so/1144a7a69d654cf68152e25ae2407068","type":"bulleted_list","createdTime":1617017880000,"lastEditedTime":1617020040000,"title":[["Making a GET request to "],["/flag",[["c",null]]],[" with our Bearer token returns:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/2743ee7fb0374fca975c5a10b7a6b499","type":"code","createdTime":1617020100000,"lastEditedTime":1617020100000,"title":[["{\n  \"error\": \"You are not wise enough to be Odin\"\n}"]],"language":"JSON","wrap":false}],"uri":"https://www.notion.so/39b1c3e711094805966e0f40476ff6e2","type":"bulleted_list","createdTime":1617020040000,"lastEditedTime":1617020100000,"title":[["Seems like only Odin is worthy enough to view the flag! Also, trying to submit \"odin\" as the name in the login form returns:"]]},{"children":[],"uri":"https://www.notion.so/fbe6046a39ae478a83ed6d99e743bf45","type":"bulleted_list","createdTime":1617020187351,"lastEditedTime":1617020160000,"title":[["Though, since we can obtain a sample access token and are in possession of the secret key, we can forge our own tokens to authenticate as the Odin user."]]},{"children":[],"uri":"https://www.notion.so/b4e7ee1ba3884b7aa3c2ef1915ad5b06","type":"heading","createdTime":1617019980000,"lastEditedTime":1617020040000,"title":[["Forging Odin's token"]],"depth":2},{"children":[{"children":[],"uri":"https://www.notion.so/cca6c326f42c4606950bba9ae733fd70","type":"image","createdTime":1617018240000,"lastEditedTime":1617020400000,"source":"https://i.imgur.com/gRvcmbl.png?width=816","caption":[],"width":816,"height":-1,"fullWidth":false,"pageWidth":false,"aspectRatio":-1,"preserveScale":true}],"uri":"https://www.notion.so/a5d18d4cddd74701b9c31101d008ce6d","type":"bulleted_list","createdTime":1617018240000,"lastEditedTime":1617018360000,"title":[["Using "],["CyberChef",[["a","https://gchq.github.io/CyberChef/"]]],[" tool, we can easily read the payload of our own JWT string with the \"JWT decode\" function:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/c9339a06cc7f445c87775fa70cd7aadf","type":"code","createdTime":1617018420000,"lastEditedTime":1617018420000,"title":[["{\n    \"fresh\": false,\n    \"iat\": 1617017482,\n    \"jti\": \"380b9f5c-fb31-479e-a189-59e2c8040453\",\n    \"nbf\": 1617017482,\n    \"type\": \"access\",\n    \"sub\": \"samiko\",\n    \"exp\": 1617018382\n}"]],"language":"JSON","wrap":false}],"uri":"https://www.notion.so/e227915a79e943f7bff1cf0960a07144","type":"bulleted_list","createdTime":1617018360000,"lastEditedTime":1617018420000,"title":[["We see that the JWT payload contains the following data:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/348ea03110184897a27c776685617d72","type":"code","createdTime":1617018780000,"lastEditedTime":1617018960000,"title":[["{\n    \"fresh\": false,\n    \"iat\": 1617017482,\n    \"jti\": \"380b9f5c-fb31-479e-a189-59e2c8040453\",\n    \"nbf\": 1617017482,\n    \"type\": \"access\",\n    \"sub\": \"odin\",\n    \"exp\": 9999999999\n}"]],"language":"JSON","wrap":false}],"uri":"https://www.notion.so/3c785c2284d147728dfb6b14ed96f970","type":"bulleted_list","createdTime":1617018420000,"lastEditedTime":1617019020000,"title":[["Of all variables, "],["sub",[["c",null]]],[" (subject) and "],["exp",[["c",null]]],[" (expiration time) are the ones that appear most interesting to us, since we want to forge a token for Odin (that never expires!), so let's modify the payload to the following:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/9219556bf7b04dcd83d88cea363580fc","type":"image","createdTime":1617019080000,"lastEditedTime":1617020400000,"source":"https://i.imgur.com/AEjoHH4.png?width=816","caption":[],"width":816,"height":-1,"fullWidth":false,"pageWidth":false,"aspectRatio":-1,"preserveScale":true}],"uri":"https://www.notion.so/99afcc1d001c44ce9006680e020655e7","type":"bulleted_list","createdTime":1617018960000,"lastEditedTime":1617020220000,"title":[["Using the \"JWT Sign\" function with the leaked "],["jwt_secret_key",[["c",null]]],[" and HS256 as parameters, we get the token:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/a6c7c17bdea2410798d05f6330a33d8c","type":"image","createdTime":1617020340000,"lastEditedTime":1617020400000,"source":"https://i.imgur.com/Tq2jaX7.png?width=1392","caption":[],"width":1392,"height":-1,"fullWidth":false,"pageWidth":false,"aspectRatio":-1,"preserveScale":true}],"uri":"https://www.notion.so/c8a17dfd437a41fa97929da98b6359c2","type":"bulleted_list","createdTime":1617020220000,"lastEditedTime":1617020340000,"title":[["Using the forged token in the HTTP header as a Bearer token, we make a GET request to "],["/flag",[["c",null]]],[":"]]},{"children":[{"children":[],"uri":"https://www.notion.so/51d14d788d5d445aa9aa4d8059a3ee50","type":"code","createdTime":1617020340000,"lastEditedTime":1617020340000,"title":[["UMASS{liveheim_laughheim_loveheim}"]],"language":"JSON","wrap":false}],"uri":"https://www.notion.so/7a4b0c3a0c92437282d658b613aa239d","type":"bulleted_list","createdTime":1617020340000,"lastEditedTime":1617020340000,"title":[["Voila! We got the flag:"]]},{"children":[],"uri":"https://www.notion.so/57058c7bb15c49dd973880e8711a7188","type":"heading","createdTime":1617009640482,"lastEditedTime":1617011760000,"title":[["Resources"]],"depth":2},{"children":[],"uri":"https://www.notion.so/87150da3481243a7904d14216f859525","type":"numbered_list","createdTime":1617012300000,"lastEditedTime":1617012300000,"title":[["https://swagger.io/docs/specification/authentication/bearer-authentication/",[["a","https://swagger.io/docs/specification/authentication/bearer-authentication/"]]]]},{"children":[],"uri":"https://www.notion.so/9181f46889a74b3cb6c3ff5c1c461277","type":"numbered_list","createdTime":1617015360000,"lastEditedTime":1617020340000,"title":[["https://research.securitum.com/jwt-json-web-token-security/",[["a","https://research.securitum.com/jwt-json-web-token-security/"]]]]},{"children":[],"uri":"https://www.notion.so/60f3ff8a01234d31a9fab5c579b452a1","type":"numbered_list","createdTime":1617020340000,"lastEditedTime":1617020340000,"title":[["https://gchq.github.io/CyberChef/",[["a","https://gchq.github.io/CyberChef/"]]]]},{"children":[],"uri":"https://www.notion.so/63b72b29db0341ac81a6dc4bfa1e2bd1","type":"text","createdTime":1617020340000,"lastEditedTime":1617020340000,"title":[]}],"uri":"https://www.notion.so/7164fde9fd1b497497bc1c79cab811f7","type":"page","createdTime":1617009643033,"lastEditedTime":1617024240000,"title":[["Heim - UMassCTF '21"]],"icon":"🏔️","fullWidth":true,"coverPosition":1,"properties":{"!`\"w":[["Yes"]],"'2]%":[["heim"]],"98uZ":[["Only those who BEARER a token may enter! A web exploitation category challenge on intercepting and forging JSON Web Tokens from a debugging endpoint to bypass Bearer authentication."]],":H`m":[["Yes"]],"xY$N":[["‣",[["d",{"type":"datetime","time_zone":"Australia/Adelaide","start_date":"2021-03-29","start_time":"23:54"}]]]],"{iD?":[["UMassCTF'21,Web Application,Bearer Authentication"]],"|Ay0":[["post"]],"title":[["Heim - UMassCTF '21"]]}}